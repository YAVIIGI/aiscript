var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,u=(e,t)=>{for(var r in t||(t={}))s.call(t,r)&&o(e,r,t[r]);if(n)for(var r of n(t))a.call(t,r)&&o(e,r,t[r]);return e};import{a as l,v as i,s as f,l as c,t as h,b as p,i as v,r as d,w as y,o as m,c as g,d as x,u as b,e as A,F as P,f as w,g as C,h as k,p as _,P as S,j as M}from"./vendor.4481e40c.js";class j extends Error{constructor(e,t){super(e),this.info=t,Error.captureStackTrace&&Error.captureStackTrace(this,j)}}var O=Object.defineProperty,$=Object.getOwnPropertyDescriptor,E=(e,t,r,n)=>{for(var s,a=n>1?void 0:n?$(t,r):t,o=e.length-1;o>=0;o--)(s=e[o])&&(a=(n?s(t,r,a):s(a))||a);return n&&a&&O(t,r,a),a};const D=class{constructor(e=[],t,r){this.opts={},this.layerdStates=e,this.parent=t,this.name=r||(1===e.length?"<root>":"<anonymous>")}log(e,t){this.parent?this.parent.log(e,t):this.opts.log&&this.opts.log(e,t)}onUpdated(e,t){this.parent?this.parent.onUpdated(e,t):this.opts.onUpdated&&this.opts.onUpdated(e,t)}createChildScope(e=new Map,t){const r=[e,...this.layerdStates];return new D(r,this,t)}get(e){for(const t of this.layerdStates)if(t.has(e)){const r=t.get(e);return this.log("read",{var:e,val:r}),r}throw new j(`No such variable '${e}' in scope '${this.name}'`,{scope:this.layerdStates})}getAll(){const e=this.layerdStates.reduce(((e,t)=>[...e,...t]),[]);return new Map(e)}add(e,t){if(this.log("add",{var:e,val:t}),this.layerdStates[0].has(e))throw new j(`Variable '${e}' is alerady exists in scope '${this.name}'`,{scope:this.layerdStates});this.layerdStates[0].set(e,t),null==this.parent&&this.onUpdated(e,t)}assign(e,t){let r=1;for(const n of this.layerdStates){if(n.has(e))return n.set(e,t),this.log("assign",{var:e,val:t}),void(r===this.layerdStates.length&&this.onUpdated(e,t));r++}throw new j(`No such variable '${e}' in scope '${this.name}'`,{scope:this.layerdStates})}};let N=D;E([l],N.prototype,"log",1),E([l],N.prototype,"onUpdated",1),E([l],N.prototype,"createChildScope",1),E([l],N.prototype,"get",1),E([l],N.prototype,"getAll",1),E([l],N.prototype,"add",1),E([l],N.prototype,"assign",1);const H={type:"null"},q={type:"bool",value:!0},F={type:"bool",value:!1},T=e=>({type:"num",value:e}),I=e=>({type:"str",value:e}),U=e=>({type:"bool",value:e}),z=e=>({type:"obj",value:e}),R=e=>({type:"arr",value:e}),Z=e=>({type:"fn",native:e});function J(e){if("bool"!==e.type)throw new j(`Expect boolean, but got ${e.type}.`)}function B(e){if("fn"!==e.type)throw new j(`Expect function, but got ${e.type}.`)}function V(e){if("str"!==e.type)throw new j(`Expect string, but got ${e.type}.`)}function L(e){if("num"!==e.type)throw new j(`Expect number, but got ${e.type}.`)}function Y(e){if("obj"!==e.type)throw new j(`Expect object, but got ${e.type}.`)}function G(e){if("arr"!==e.type)throw new j(`Expect array, but got ${e.type}.`)}function K(e,t){return"fn"!==e.type&&"fn"!==t.type&&("null"===e.type&&"null"===t.type||"null"!==e.type&&"null"!==t.type&&e.value===t.value)}function Q(e,t=!1){if(t){if("num"===e.type)return e.value.toString();if("bool"===e.type)return e.value?"true":"false";if("str"===e.type)return`"${e.value}"`;if("arr"===e.type)return`[${e.value.map((e=>Q(e,!0))).join(", ")}]`;if("null"===e.type)return"(null)"}const r="num"===e.type||"bool"===e.type?e.value:"str"===e.type?`"${e.value}"`:"fn"===e.type||"obj"===e.type?"...":"null"===e.type?"":null;return`${e.type}<${r}>`}function W(e){switch(e.type){case"arr":return e.value.map((e=>W(e)));case"bool":return e.value;case"null":return null;case"num":return e.value;case"obj":{const t={};for(const[r,n]of e.value.entries())t[r]=W(n);return t}case"str":return e.value;default:return}}function X(e){if(null===e)return H;if("boolean"==typeof e)return U(e);if("string"==typeof e)return I(e);if("number"==typeof e)return T(e);if(Array.isArray(e))return R(e.map((e=>X(e))));if("object"==typeof e){const t=new Map;for(const[r,n]of Object.entries(e))t.set(r,X(n));return z(t)}return H}const ee={help:I("SEE: https://github.com/syuilo/aiscript/blob/master/docs/get-started.md"),"Core:v":I("0.11.1"),"Core:ai":I("kawaii"),"Core:not":Z((([e])=>(J(e),e.value?F:q))),"Core:eq":Z((([e,t])=>K(e,t)?q:F)),"Core:neq":Z((([e,t])=>K(e,t)?F:q)),"Core:and":Z((([e,t])=>(J(e),J(t),e.value&&t.value?q:F))),"Core:or":Z((([e,t])=>(J(e),J(t),e.value||t.value?q:F))),"Core:add":Z((([e,t])=>(L(e),L(t),T(e.value+t.value)))),"Core:sub":Z((([e,t])=>(L(e),L(t),T(e.value-t.value)))),"Core:mul":Z((([e,t])=>(L(e),L(t),T(e.value*t.value)))),"Core:div":Z((([e,t])=>{L(e),L(t);const r=e.value/t.value;if(isNaN(r))throw new j("Invalid operation.");return T(r)})),"Core:mod":Z((([e,t])=>(L(e),L(t),T(e.value%t.value)))),"Core:gt":Z((([e,t])=>(L(e),L(t),e.value>t.value?q:F))),"Core:lt":Z((([e,t])=>(L(e),L(t),e.value<t.value?q:F))),"Core:gteq":Z((([e,t])=>(L(e),L(t),e.value>=t.value?q:F))),"Core:lteq":Z((([e,t])=>(L(e),L(t),e.value<=t.value?q:F))),"Core:type":Z((([e])=>I(e.type))),"Core:to_str":Z((([e])=>"str"===e.type?e:"num"===e.type?I(e.value.toString()):I("?"))),"Core:range":Z((([e,t])=>(L(e),L(t),e.value<t.value?R(Array.from({length:t.value-e.value+1},((t,r)=>T(r+e.value)))):e.value>t.value?R(Array.from({length:e.value-t.value+1},((t,r)=>T(e.value-r)))):R([e])))),"Util:uuid":Z((()=>I(i()))),"Json:stringify":Z((([e])=>I(JSON.stringify(W(e))))),"Json:parse":Z((([e])=>(V(e),X(JSON.parse(e.value))))),"Date:now":Z((()=>T(Date.now()))),"Date:year":Z((()=>T((new Date).getFullYear()))),"Date:month":Z((()=>T((new Date).getMonth()+1))),"Date:day":Z((()=>T((new Date).getDate()))),"Date:hour":Z((()=>T((new Date).getHours()))),"Date:minute":Z((()=>T((new Date).getMinutes()))),"Date:second":Z((()=>T((new Date).getSeconds()))),"Date:parse":Z((([e])=>(V(e),T(new Date(e.value).getTime())))),"Math:PI":T(Math.PI),"Math:sin":Z((([e])=>(L(e),T(Math.sin(e.value))))),"Math:cos":Z((([e])=>(L(e),T(Math.cos(e.value))))),"Math:abs":Z((([e])=>(L(e),T(Math.abs(e.value))))),"Math:sqrt":Z((([e])=>{L(e);const t=Math.sqrt(e.value);if(isNaN(t))throw new j("Invalid operation.");return T(t)})),"Math:round":Z((([e])=>(L(e),T(Math.round(e.value))))),"Math:floor":Z((([e])=>(L(e),T(Math.floor(e.value))))),"Math:min":Z((([e,t])=>(L(e),L(t),T(Math.min(e.value,t.value))))),"Math:max":Z((([e,t])=>(L(e),L(t),T(Math.max(e.value,t.value))))),"Math:rnd":Z((([e,t])=>e&&"num"===e.type&&t&&"num"===t.type?T(Math.floor(Math.random()*(t.value-e.value+1)+e.value)):T(Math.random()))),"Math:gen_rng":Z((([e])=>{if("num"!==e.type&&"str"!==e.type)return H;const t=f(e.value.toString());return Z((([e,r])=>e&&"num"===e.type&&r&&"num"===r.type?T(Math.floor(t()*(r.value-e.value+1)+e.value)):T(t())))})),"Num:to_hex":Z((([e])=>(L(e),I(e.value.toString(16))))),"Num:from_hex":Z((([e])=>(V(e),T(parseInt(e.value,16))))),"Str:lf":I("\n"),"Str:to_num":Z((([e])=>{if("num"===e.type)return e;if("str"===e.type){const t=parseInt(e.value,10);return isNaN(t)?H:T(t)}return H})),"Str:len":Z((([e])=>"str"!==e.type?T(0):T(c(e.value)))),"Str:pick":Z((([e,t])=>{V(e),L(t);const r=h(e.value)[t.value-1];return r?I(r):H})),"Str:incl":Z((([e,t])=>(V(e),V(t),e.value.includes(t.value)?q:F))),"Str:slice":Z((([e,t,r])=>(V(e),L(t),L(r),I(p(e.value,t.value-1,r.value-1))))),"Str:split":Z((([e,t])=>(V(e),t&&V(t),R(t?e.value.split(t?t.value:"").map((e=>I(e))):h(e.value).map((e=>I(e))))))),"Str:replace":Z((([e,t,r])=>(V(e),V(t),V(r),I(e.value.split(t.value).join(r.value))))),"Str:index_of":Z((([e,t])=>(V(e),V(t),T(v(e.value,t.value)+1)))),"Str:trim":Z((([e])=>(V(e),I(e.value.trim())))),"Str:upper":Z((([e])=>(V(e),I(e.value.toUpperCase())))),"Str:lower":Z((([e])=>(V(e),I(e.value.toLowerCase())))),"Arr:len":Z((([e])=>"arr"!==e.type?T(0):T(e.value.length))),"Arr:push":Z((([e,t])=>(G(e),e.value.push(t),H))),"Arr:unshift":Z((([e,t])=>(G(e),e.value.unshift(t),H))),"Arr:pop":Z((([e])=>(G(e),e.value.pop()))),"Arr:shift":Z((([e])=>(G(e),e.value.shift()))),"Arr:concat":Z((([e,t])=>(G(e),G(t),R(e.value.concat(t.value))))),"Arr:join":Z((([e,t])=>(G(e),t&&V(t),I(e.value.map((e=>"str"===e.type?e.value:"")).join(t?t.value:""))))),"Arr:slice":Z((([e,t,r])=>(G(e),L(t),L(r),R(e.value.slice(t.value-1,r.value-1))))),"Arr:incl":Z((([e,t])=>{if(G(e),"str"!==t.type&&"num"!==t.type&&"bool"!==t.type&&"null"!==t.type)return F;return(r=e,r.value.map((e=>"str"===e.type||"num"===e.type||"bool"===e.type?e.value:"null"===e.type?null:Symbol()))).includes("null"===t.type?null:t.value)?q:F;var r})),"Arr:map":Z((async([e,t],r)=>{G(e),B(t);const n=e.value.map((async(e,n)=>await r.call(t,[e,T(n+1)])));return R(await Promise.all(n))})),"Arr:filter":Z((async([e,t],r)=>{G(e),B(t);const n=[];for(let s=0;s<e.value.length;s++){const a=e.value[s],o=await r.call(t,[a,T(s+1)]);J(o),o.value&&n.push(a)}return R(n)})),"Arr:reduce":Z((async([e,t,r],n)=>{G(e),B(t);const s=null!=r;let a=s?r:e.value[0];for(let o=s?0:1;o<e.value.length;o++){const r=e.value[o];a=await n.call(t,[a,r,T(o+1)])}return a})),"Arr:find":Z((async([e,t],r)=>{G(e),B(t);for(let n=0;n<e.value.length;n++){const s=e.value[n],a=await r.call(t,[s,T(n+1)]);if(J(a),a.value)return s}return H})),"Arr:reverse":Z((([e])=>(G(e),e.value.reverse(),H))),"Arr:copy":Z((async([e])=>(G(e),R([...e.value])))),"Obj:keys":Z((([e])=>(Y(e),R(Array.from(e.value.keys()).map((e=>I(e))))))),"Obj:kvs":Z((([e])=>(Y(e),R(Array.from(e.value.entries()).map((([e,t])=>R([I(e),t]))))))),"Obj:get":Z((([e,t])=>(Y(e),V(t),e.value.get(t.value)||H))),"Obj:set":Z((([e,t,r])=>(Y(e),V(t),e.value.set(t.value,r),H))),"Obj:has":Z((([e,t])=>(Y(e),V(t),U(e.value.has(t.value))))),"Obj:copy":Z((([e])=>(Y(e),z(new Map(e.value))))),"Async:interval":Z((async([e,t,r],n)=>{L(e),B(t),r&&J(r),r&&n.call(t,[]);const s=setInterval((()=>{n.call(t,[])}),e.value),a=()=>{clearInterval(s)};return n.registerAbortHandler(a),Z((([],e)=>{clearInterval(s),e.unregisterAbortHandler(a)}))})),"Async:timeout":Z((async([e,t],r)=>{L(e),B(t);const n=setTimeout((()=>{r.call(t,[])}),e.value),s=()=>{clearTimeout(n)};return r.registerAbortHandler(s),Z((([],e)=>{clearTimeout(n),e.unregisterAbortHandler(s)}))}))};function te(e,t,r){return{type:"infixTree",left:e,right:t,info:r}}function re(e,t,r){if("infixTree"!==e.type)return te(e,t,r);if(r.priority<=e.info.priority)return te(e,t,r);{const{left:n,right:s,info:a}=e;return te(n,re(s,t,r),a)}}function ne(e){return"infixTree"!==e.type?e:{type:"call",target:{type:"var",name:e.info.func},args:[ne(e.left),ne(e.right)]}}const se={"*":{func:"Core:mul",priority:7},"/":{func:"Core:div",priority:7},"%":{func:"Core:mod",priority:7},"+":{func:"Core:add",priority:6},"-":{func:"Core:sub",priority:6},"==":{func:"Core:eq",priority:4},"!=":{func:"Core:neq",priority:4},"<":{func:"Core:lt",priority:4},">":{func:"Core:gt",priority:4},"<=":{func:"Core:lteq",priority:4},">=":{func:"Core:gteq",priority:4},"&&":{func:"Core:and",priority:3},"||":{func:"Core:or",priority:2}};function ae(e){const t=e.operators.map((e=>{const t=se[e];if(null==t)throw new j(`No such operator: ${e}.`);return t}));let r=te(e.operands[0],e.operands[1],t[0]);for(let n=0;n<t.length-1;n++)r=re(r,e.operands[2+n],t[1+n]);return ne(r)}var oe=Object.defineProperty,ue=Object.getOwnPropertyDescriptor,le=(e,t,r,n)=>{for(var s,a=n>1?void 0:n?ue(t,r):t,o=e.length-1;o>=0;o--)(s=e[o])&&(a=(n?s(t,r,a):s(a))||a);return n&&a&&oe(t,r,a),a};class ie{constructor(e,t){this.stepCount=0,this.stop=!1,this.abortHandlers=[],this.opts=t||{};const r={print:Z((e=>{this.opts.out&&this.opts.out(e[0])})),readline:Z((async e=>{const t=e[0];if(V(t),null==this.opts.in)return H;const r=await this.opts.in(t.value);return I(r)}))};this.vars=u(u(u({},e),ee),r),this.scope=new N([new Map(Object.entries(this.vars))]),this.scope.opts.log=(e,t)=>{switch(e){case"add":this.log("var:add",t);break;case"read":this.log("var:read",t);break;case"write":this.log("var:write",t)}}}async exec(e){if(null==e||0===e.length)return;await this.collectNs(e);const t=await this._run(e,this.scope);this.log("end",{val:t})}async execFn(e,t){return this._fn(e,t)}static collectMetadata(e){if(null==e||0===e.length)return;function t(e){switch(e.type){case"arr":return e.value.map((e=>t(e)));case"bool":return e.value;case"null":return null;case"num":return e.value;case"obj":{const r={};for(const[n,s]of e.value.entries())r[n]=t(s);return r}case"str":return e.value}}const r=new Map;for(const n of e)switch(n.type){case"meta":r.set(n.name,t(n.value))}return r}log(e,t){this.opts.log&&this.opts.log(e,t)}async collectNs(e){for(const t of e)switch(t.type){case"ns":await this.collectNsMember(t)}}async collectNsMember(e){const t=this.scope.createChildScope();for(const r of e.members)switch(r.type){case"def":{const n=await this._eval(r.expr,t);t.add(r.name,n),this.scope.add(e.name+":"+r.name,n);break}case"ns":break;default:throw new Error("invalid ns member type: "+r.type)}}async _fn(e,t){if(e.native){return await Promise.resolve(e.native(t,{call:this._fn,registerAbortHandler:this.registerAbortHandler,unregisterAbortHandler:this.unregisterAbortHandler}))||H}{const n=new Map;for(let r=0;r<(e.args||[]).length;r++)n.set(e.args[r],t[r]);const s=e.scope.createChildScope(n);return"return"===(r=await this._run(e.statements,s)).type?r.value:r}var r}async _eval(e,t){if(this.stop)return H;if(this.log("node",{node:e}),this.stepCount++,this.opts.maxStep&&this.stepCount>this.opts.maxStep)throw new j("max step exceeded");switch(e.type){case"call":{const r=await this._eval(e.target,t);B(r);const n=await Promise.all(e.args.map((async e=>await this._eval(e,t))));return this._fn(r,n)}case"if":{const r=await this._eval(e.cond,t);if(J(r),r.value)return this._eval(e.then,t);if(e.elseif&&e.elseif.length>0){for(const r of e.elseif){const e=await this._eval(r.cond,t);if(J(e),e.value)return this._eval(r.then,t)}if(e.else)return this._eval(e.else,t)}else if(e.else)return this._eval(e.else,t);return H}case"match":{const r=await this._eval(e.about,t);for(const n of e.qs){if(K(r,await this._eval(n.q,t)))return await this._eval(n.a,t)}return e.default?await this._eval(e.default,t):H}case"loop":for(;;){const r=await this._run(e.statements,t.createChildScope());if("break"===r.type)break;if("return"===r.type)return r.value}return H;case"for":if(e.times){const r=await this._eval(e.times,t);L(r);for(let n=1;n<r.value+1;n++){const r=await this._eval(e.for,t);if("break"===r.type)break;if("return"===r.type)return r.value}}else{const r=await this._eval(e.from,t),n=await this._eval(e.to,t);L(r),L(n);for(let s=r.value+1;s<n.value+1;s++){const r=await this._eval(e.for,t.createChildScope(new Map([[e.var,T(s)]])));if("break"===r.type)break;if("return"===r.type)return r.value}}return H;case"forOf":{const r=await this._eval(e.items,t);G(r);for(const n of r.value)await this._eval(e.for,t.createChildScope(new Map([[e.var,n]])));return H}case"def":{const r=await this._eval(e.expr,t);if(e.attr.length>0){const n=[];for(const r of e.attr)n.push({name:r.name,value:await this._eval(r.value,t)});r.attr=n}return t.add(e.name,r),H}case"var":return t.get(e.name);case"assign":{const r=await this._eval(e.expr,t);if("var"===e.dest.type)return t.assign(e.dest.name,r),H;if("index"===e.dest.type){const n=await this._eval(e.dest.target,t);G(n);const s=await this._eval(e.dest.index,t);return L(s),n.value[s.value-1]=r,H}if("prop"===e.dest.type){const n=await this._eval(e.dest.target,t);return Y(n),n.value.set(e.dest.name,r),H}throw new j("The left-hand side of an assignment expression must be a variable or a property/index access.")}case"inc":{const r=await this._eval(e.dest,t);L(r);const n=await this._eval(e.expr,t);return L(n),r.value+=n.value,H}case"dec":{const r=await this._eval(e.dest,t);L(r);const n=await this._eval(e.expr,t);return L(n),r.value-=n.value,H}case"null":return H;case"bool":return U(e.value);case"num":return T(e.value);case"str":return I(e.value);case"arr":return R(await Promise.all(e.value.map((async e=>await this._eval(e,t)))));case"obj":{const r=new Map;for(const n of e.value.keys())r.set(n,await this._eval(e.value.get(n),t));return z(r)}case"prop":{const r=await this._eval(e.target,t);return Y(r),r.value.has(e.name)?r.value.get(e.name):H}case"index":{const r=await this._eval(e.target,t);G(r);const n=await this._eval(e.index,t);return L(n),r.value[n.value-1]}case"fn":return((e,t,r)=>({type:"fn",args:e,statements:t,scope:r}))(e.args.map((e=>e.name)),e.children,t);case"block":return this._run(e.statements,t.createChildScope());case"tmpl":{let r="";for(const n of e.tmpl)if("string"==typeof n)r+=n;else{const e=await this._eval(n,t);let s="";"str"===e.type?s=e.value:"num"===e.type&&(s=e.value.toString()),r+=s}return I(r)}case"infix":return this._eval(ae(e),t);case"return":{const r=await this._eval(e.expr,t);return this.log("block:return",{scope:t.name,val:r}),{type:"return",value:r}}case"break":return this.log("block:break",{scope:t.name}),{type:"break",value:null};case"continue":return this.log("block:continue",{scope:t.name}),{type:"continue",value:null};case"ns":case"meta":return H;default:throw new Error("invalid node type")}}async _run(e,t){this.log("block:enter",{scope:t.name});let r=H;for(let n=0;n<e.length;n++){const s=e[n];if(r=await this._eval(s,t),"return"===r.type)return this.log("block:return",{scope:t.name,val:r.value}),r;if("break"===r.type)return this.log("block:break",{scope:t.name}),r;if("continue"===r.type)return this.log("block:continue",{scope:t.name}),r}return this.log("block:leave",{scope:t.name,val:r}),r}registerAbortHandler(e){this.abortHandlers.push(e)}unregisterAbortHandler(e){this.abortHandlers=this.abortHandlers.filter((t=>t!==e))}abort(){this.stop=!0;for(const e of this.abortHandlers)e();this.abortHandlers=[]}}function fe(e,t,r,n){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,fe.prototype),s.expected=t,s.found=r,s.location=n,s.name="SyntaxError",s}function ce(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function he(e,n){var s,a,o,l,i={},f=(n=void 0!==n?n:{}).grammarSource,c={Preprocess:rr,Main:function(){var e,t,r,n,s,a=73*Zt+3,o=Gt[a];if(o)return Zt=o.nextPos,o.result;e=Zt,t=[],r=Fr();for(;r!==i;)t.push(r),r=Fr();(r=sr())===i&&(r=null);n=[],s=Fr();for(;s!==i;)n.push(s),s=Fr();return Jt=e,e=kt(r),Gt[a]={nextPos:Zt,result:e},e}},h=rr,p="//",v="(",d=")",y="{",m="}",g="###",x="let",b=":",A="=",P="<:",w="#[",C="]",k="each",_=",",S="for",M="return",j="loop",O="break",$="continue",E="+=",D="-=",N="[",H=".",q="if",F="elif",T="else",I="match",U="=>",z="eval",R="`",Z="\\{",J="\\}",B="\\`",V='"',L="true",Y="false",G="null",K=";",Q="@(",W=/^[A-Z0-9_:]/i,X=/^[\-+*\/%&|=~<>!?]/,ee=/^[+\-]/,te=/^[1-9]/,re=/^[0-9]/,ne=/^[A-Z_]/i,se=/^[A-Z0-9_]/i,ae=/^[\r\n]/,oe=/^[ \t\r\n]/,ue=/^[ \t]/,le={type:"any"},ie=Qt("//",!1),ce=Qt("(",!1),he=Qt(")",!1),pe=Qt("::",!1),ve=Qt("{",!1),de=Qt("}",!1),ye=Qt("###",!1),me=Qt("let",!1),ge=Qt(":",!1),xe=Qt("=",!1),be=Qt("var",!1),Ae=Qt("<:",!1),Pe=Qt("#[",!1),we=Qt("]",!1),Ce=Qt("each",!1),ke=Qt(",",!1),_e=Qt("for",!1),Se=Qt("return",!1),Me=Wt([["A","Z"],["0","9"],"_",":"],!1,!0),je=Qt("loop",!1),Oe=Qt("break",!1),$e=Qt("continue",!1),Ee=Qt("+=",!1),De=Qt("-=",!1),Ne=Qt("\\",!1),He=Qt("||",!1),qe=Qt("&&",!1),Fe=Qt("==",!1),Te=Qt("!=",!1),Ie=Qt("<=",!1),Ue=Qt(">=",!1),ze=Qt("<",!1),Re=Qt(">",!1),Ze=Qt("+",!1),Je=Qt("-",!1),Be=Qt("*",!1),Ve=Qt("/",!1),Le=Qt("%",!1),Ye=Wt(["-","+","*","/","%","&","|","=","~","<",">","!","?"],!1,!1),Ge=Qt("[",!1),Ke=Qt(".",!1),Qe=Qt("if",!1),We=Qt("elif",!1),Xe=Qt("else",!1),et=Qt("match",!1),tt=Qt("=>",!1),rt=Qt("eval",!1),nt=Qt("`",!1),st=Qt("\\{",!1),at=Qt("\\}",!1),ot=Qt("\\`",!1),ut=Qt('"',!1),lt=Qt('\\"',!1),it=Wt(["+","-"],!1,!1),ft=Wt([["1","9"]],!1,!1),ct=Wt([["0","9"]],!1,!1),ht=Qt("true",!1),pt=Qt("false",!1),vt=Qt("null",!1),dt=Qt(";",!1),yt=Qt("@",!1),mt=Qt("@(",!1),gt=Wt([["A","Z"],"_"],!1,!0),xt=Wt([["A","Z"],["0","9"],"_"],!1,!0),bt=Qt("\r\n",!1),At=Wt(["\r","\n"],!1,!1),Pt=Wt([" ","\t","\r","\n"],!1,!1),wt=Wt([" ","\t"],!1,!1),Ct=function(){return Kt()},kt=function(e){return e||[]},_t=function(e,t){return t},St=function(e,t){return[e,...t]},Mt=function(e,t,r){return Ur("forOf",{var:e,items:t,for:r})},jt=function(e,t){return t},Ot=function(e,t,r,n){return Ur("for",{var:e,from:t||Ur("num",{value:0}),to:r,for:n})},$t=function(e,t){return Ur("for",{times:e,for:t})},Et=function(e,t,r){return{op:t,term:r}},Dt=function(e,n){return s=u({},e),t(s,r({chain:n}));var s},Nt=function(e,t){return t},Ht=function(e,t,r){return{q:t,a:r}},qt=function(){return Kt()[1]},Ft=function(){return Ur("num",{value:parseFloat(Kt())})},Tt=function(){return Ur("num",{value:parseInt(Kt(),10)})},It=function(e,t){return{k:e,v:t}},Ut=function(e){const t=new Map;for(const r of e)t.set(r.k,r.v);return Ur("obj",{value:t})},zt=function(e){return Ur("arr",{value:e})},Rt=function(e,t,r,n,s,a){return(e.length>0||r.length>0)&&function(e,t){throw t=void 0!==t?t:er(Jt,Zt),function(e,t){return new fe(e,null,null,t)}(e,t)}("Cannot use spaces before or after the function name."),Ur("def",{name:t,expr:Ur("fn",{args:n||[],ret:s},a||[]),mut:!1,attr:[]})},Zt=0,Jt=0,Bt=[{line:1,column:1}],Vt=0,Lt=[],Yt=0,Gt={};if("startRule"in n){if(!(n.startRule in c))throw new Error("Can't start parsing from rule \""+n.startRule+'".');h=c[n.startRule]}function Kt(){return e.substring(Jt,Zt)}function Qt(e,t){return{type:"literal",text:e,ignoreCase:t}}function Wt(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Xt(t){var r,n=Bt[t];if(n)return n;for(r=t-1;!Bt[r];)r--;for(n={line:(n=Bt[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Bt[t]=n,n}function er(e,t){var r=Xt(e),n=Xt(t);return{source:f,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function tr(e){Zt<Vt||(Zt>Vt&&(Vt=Zt,Lt=[]),Lt.push(e))}function rr(){var e,t,r,n=73*Zt+0,s=Gt[n];if(s)return Zt=s.nextPos,s.result;for(e=Zt,t=[],r=nr();r!==i;)t.push(r),r=nr();return Jt=e,e=t=t.join(""),Gt[n]={nextPos:Zt,result:e},e}function nr(){var t,r,n=73*Zt+1,s=Gt[n];return s?(Zt=s.nextPos,s.result):(t=Zt,(r=Ar())!==i&&(Jt=t,r=Ct()),(t=r)===i&&(t=Zt,(r=wr())!==i&&(Jt=t,r=Ct()),(t=r)===i&&(t=function(){var t,r,n,s,a,o,u=73*Zt+2,l=Gt[u];if(l)return Zt=l.nextPos,l.result;t=Zt,e.substr(Zt,2)===p?(r=p,Zt+=2):(r=i,0===Yt&&tr(ie));if(r!==i){for(n=[],s=Zt,a=Zt,Yt++,o=qr(),Yt--,o===i?a=void 0:(Zt=a,a=i),a!==i?(e.length>Zt?(o=e.charAt(Zt),Zt++):(o=i,0===Yt&&tr(le)),o!==i?s=a=[a,o]:(Zt=s,s=i)):(Zt=s,s=i);s!==i;)n.push(s),s=Zt,a=Zt,Yt++,o=qr(),Yt--,o===i?a=void 0:(Zt=a,a=i),a!==i?(e.length>Zt?(o=e.charAt(Zt),Zt++):(o=i,0===Yt&&tr(le)),o!==i?s=a=[a,o]:(Zt=s,s=i)):(Zt=s,s=i);Jt=t,t=""}else Zt=t,t=i;return Gt[u]={nextPos:Zt,result:t},t}())===i&&(e.length>Zt?(t=e.charAt(Zt),Zt++):(t=i,0===Yt&&tr(le)))),Gt[n]={nextPos:Zt,result:t},t)}function sr(){var e,t,r,n,s,a,o,u,l=73*Zt+4,f=Gt[l];if(f)return Zt=f.nextPos,f.result;if(e=Zt,(t=or())!==i){for(r=[],n=Zt,s=[],a=Tr();a!==i;)s.push(a),a=Tr();if((a=Hr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=or())!==i?(Jt=n,n=_t(0,u)):(Zt=n,n=i)}else Zt=n,n=i;for(;n!==i;){for(r.push(n),n=Zt,s=[],a=Tr();a!==i;)s.push(a),a=Tr();if((a=Hr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=or())!==i?(Jt=n,n=_t(0,u)):(Zt=n,n=i)}else Zt=n,n=i}Jt=e,e=St(t,r)}else Zt=e,e=i;return Gt[l]={nextPos:Zt,result:e},e}function ar(){var e,t,r,n,s,a,o,u,l=73*Zt+6,f=Gt[l];if(f)return Zt=f.nextPos,f.result;if(e=Zt,(t=lr())!==i){for(r=[],n=Zt,s=[],a=Tr();a!==i;)s.push(a),a=Tr();if((a=Hr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=lr())!==i?(Jt=n,n=_t(0,u)):(Zt=n,n=i)}else Zt=n,n=i;for(;n!==i;){for(r.push(n),n=Zt,s=[],a=Tr();a!==i;)s.push(a),a=Tr();if((a=Hr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=lr())!==i?(Jt=n,n=_t(0,u)):(Zt=n,n=i)}else Zt=n,n=i}Jt=e,e=St(t,r)}else Zt=e,e=i;return Gt[l]={nextPos:Zt,result:e},e}function or(){var t,r=73*Zt+7,n=Gt[r];return n?(Zt=n.nextPos,n.result):((t=pr())===i&&(t=function(){var t,r,n,s,a,o,u=73*Zt+15,l=Gt[u];if(l)return Zt=l.nextPos,l.result;t=Zt,e.substr(Zt,3)===g?(r=g,Zt+=3):(r=i,0===Yt&&tr(ye));if(r!==i){for(n=[],s=Tr();s!==i;)n.push(s),s=Tr();if((s=Er())!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();(o=hr())!==i?(Jt=t,t=Ur("meta",{name:s,value:o})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i;if(t===i)if(t=Zt,e.substr(Zt,3)===g?(r=g,Zt+=3):(r=i,0===Yt&&tr(ye)),r!==i){for(n=[],s=Tr();s!==i;)n.push(s),s=Tr();(s=hr())!==i?(Jt=t,t=function(e){return Ur("meta",{name:null,value:e})}(s)):(Zt=t,t=i)}else Zt=t,t=i;return Gt[u]={nextPos:Zt,result:t},t}())===i&&(t=lr()),Gt[r]={nextPos:Zt,result:t},t)}function ur(){var e,t=73*Zt+8,r=Gt[t];return r?(Zt=r.nextPos,r.result):((e=vr())===i&&(e=Or())===i&&(e=pr()),Gt[t]={nextPos:Zt,result:e},e)}function lr(){var t,r=73*Zt+9,n=Gt[r];return n?(Zt=n.nextPos,n.result):((t=vr())===i&&(t=Or())===i&&(t=function(){var t,r,n,s,a=73*Zt+17,o=Gt[a];if(o)return Zt=o.nextPos,o.result;t=Zt,e.substr(Zt,2)===P?(r=P,Zt+=2):(r=i,0===Yt&&tr(Ae));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();(s=ir())!==i?(Jt=t,t=Ur("var",{name:"print",chain:[Ur("callChain",{args:[s]})]})):(Zt=t,t=i)}else Zt=t,t=i;return Gt[a]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o=73*Zt+21,u=Gt[o];if(u)return Zt=u.nextPos,u.result;t=Zt,e.substr(Zt,6)===M?(r=M,Zt+=6):(r=i,0===Yt&&tr(Se));if(r!==i)if(n=Zt,Yt++,W.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Me)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();(a=ir())!==i?(Jt=t,t=Ur("return",{expr:a})):(Zt=t,t=i)}else Zt=t,t=i;else Zt=t,t=i;return Gt[o]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l=73*Zt+18,f=Gt[l];if(f)return Zt=f.nextPos,f.result;t=Zt,e.substr(Zt,2)===w?(r=w,Zt+=2):(r=i,0===Yt&&tr(Pe));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if((s=Er())!==i){for(a=Zt,o=[],u=Fr();u!==i;)o.push(u),u=Fr();for((u=hr())!==i?a=u:(Zt=a,a=i),a===i&&(a=null),o=[],u=Fr();u!==i;)o.push(u),u=Fr();93===e.charCodeAt(Zt)?(u=C,Zt++):(u=i,0===Yt&&tr(we)),u!==i?(Jt=t,t=Ur("attr",{name:s,value:a||Ur("bool",{value:!0})})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i;return Gt[l]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,f,c,h,p,y,m,g=73*Zt+19,b=Gt[g];if(b)return Zt=b.nextPos,b.result;t=Zt,e.substr(Zt,4)===k?(r=k,Zt+=4):(r=i,0===Yt&&tr(Ce));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(40===e.charCodeAt(Zt)?(s=v,Zt++):(s=i,0===Yt&&tr(ce)),s!==i)if(e.substr(Zt,3)===x?(a=x,Zt+=3):(a=i,0===Yt&&tr(me)),a!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();if((u=Er())!==i){for(l=[],f=Fr();f!==i;)l.push(f),f=Fr();for(44===e.charCodeAt(Zt)?(f=_,Zt++):(f=i,0===Yt&&tr(ke)),f===i&&(f=null),c=[],h=Fr();h!==i;)c.push(h),h=Fr();if((h=ir())!==i)if(41===e.charCodeAt(Zt)?(p=d,Zt++):(p=i,0===Yt&&tr(he)),p!==i){for(y=[],m=Fr();m!==i;)y.push(m),m=Fr();(m=Nr())!==i?(Jt=t,t=Mt(u,h,m)):(Zt=t,t=i)}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;if(t===i)if(t=Zt,e.substr(Zt,4)===k?(r=k,Zt+=4):(r=i,0===Yt&&tr(Ce)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if(e.substr(Zt,3)===x?(s=x,Zt+=3):(s=i,0===Yt&&tr(me)),s!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();if((o=Er())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(Zt)?(l=_,Zt++):(l=i,0===Yt&&tr(ke)),l===i&&(l=null),f=[],c=Fr();c!==i;)f.push(c),c=Fr();if((c=ir())!==i){if(h=[],(p=Fr())!==i)for(;p!==i;)h.push(p),p=Fr();else h=i;h!==i&&(p=Nr())!==i?(Jt=t,t=Mt(o,c,p)):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;return Gt[g]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,f,c,h,p,y,m,g,b=73*Zt+20,P=Gt[b];if(P)return Zt=P.nextPos,P.result;t=Zt,e.substr(Zt,3)===S?(r=S,Zt+=3):(r=i,0===Yt&&tr(_e));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(40===e.charCodeAt(Zt)?(s=v,Zt++):(s=i,0===Yt&&tr(ce)),s!==i)if(e.substr(Zt,3)===x?(a=x,Zt+=3):(a=i,0===Yt&&tr(me)),a!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();if((u=Er())!==i){for(l=[],f=Fr();f!==i;)l.push(f),f=Fr();if(f=Zt,61===e.charCodeAt(Zt)?(c=A,Zt++):(c=i,0===Yt&&tr(xe)),c!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();(p=ir())!==i?(Jt=f,f=jt(0,p)):(Zt=f,f=i)}else Zt=f,f=i;for(f===i&&(f=null),44===e.charCodeAt(Zt)?(c=_,Zt++):(c=i,0===Yt&&tr(ke)),c===i&&(c=null),h=[],p=Fr();p!==i;)h.push(p),p=Fr();if((p=ir())!==i)if(41===e.charCodeAt(Zt)?(y=d,Zt++):(y=i,0===Yt&&tr(he)),y!==i){for(m=[],g=Fr();g!==i;)m.push(g),g=Fr();(g=Nr())!==i?(Jt=t,t=Ot(u,f,p,g)):(Zt=t,t=i)}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;if(t===i){if(t=Zt,e.substr(Zt,3)===S?(r=S,Zt+=3):(r=i,0===Yt&&tr(_e)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if(e.substr(Zt,3)===x?(s=x,Zt+=3):(s=i,0===Yt&&tr(me)),s!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();if((o=Er())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(l=Zt,61===e.charCodeAt(Zt)?(f=A,Zt++):(f=i,0===Yt&&tr(xe)),f!==i){for(c=[],h=Fr();h!==i;)c.push(h),h=Fr();(h=ir())!==i?(Jt=l,l=jt(0,h)):(Zt=l,l=i)}else Zt=l,l=i;for(l===i&&(l=null),44===e.charCodeAt(Zt)?(f=_,Zt++):(f=i,0===Yt&&tr(ke)),f===i&&(f=null),c=[],h=Fr();h!==i;)c.push(h),h=Fr();if((h=ir())!==i){if(p=[],(y=Fr())!==i)for(;y!==i;)p.push(y),y=Fr();else p=i;p!==i&&(y=Nr())!==i?(Jt=t,t=Ot(o,l,h,y)):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;if(t===i){if(t=Zt,e.substr(Zt,3)===S?(r=S,Zt+=3):(r=i,0===Yt&&tr(_e)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(40===e.charCodeAt(Zt)?(s=v,Zt++):(s=i,0===Yt&&tr(ce)),s!==i)if((a=ir())!==i)if(41===e.charCodeAt(Zt)?(o=d,Zt++):(o=i,0===Yt&&tr(he)),o!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();(l=Nr())!==i?(Jt=t,t=$t(a,l)):(Zt=t,t=i)}else Zt=t,t=i;else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;if(t===i)if(t=Zt,e.substr(Zt,3)===S?(r=S,Zt+=3):(r=i,0===Yt&&tr(_e)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=ir())!==i){if(a=[],(o=Fr())!==i)for(;o!==i;)a.push(o),o=Fr();else a=i;a!==i&&(o=Nr())!==i?(Jt=t,t=$t(s,o)):(Zt=t,t=i)}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i}}return Gt[b]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,f=73*Zt+22,c=Gt[f];if(c)return Zt=c.nextPos,c.result;t=Zt,e.substr(Zt,4)===j?(r=j,Zt+=4):(r=i,0===Yt&&tr(je));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(123===e.charCodeAt(Zt)?(s=y,Zt++):(s=i,0===Yt&&tr(ve)),s!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();if((o=ar())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();125===e.charCodeAt(Zt)?(l=m,Zt++):(l=i,0===Yt&&tr(de)),l!==i?(Jt=t,t=Ur("loop",{statements:o})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;return Gt[f]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a=73*Zt+23,o=Gt[a];if(o)return Zt=o.nextPos,o.result;t=Zt,e.substr(Zt,5)===O?(r=O,Zt+=5):(r=i,0===Yt&&tr(Oe));r!==i?(n=Zt,Yt++,W.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Me)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i?(Jt=t,t=Ur("break",{})):(Zt=t,t=i)):(Zt=t,t=i);return Gt[a]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a=73*Zt+24,o=Gt[a];if(o)return Zt=o.nextPos,o.result;t=Zt,e.substr(Zt,8)===$?(r=$,Zt+=8):(r=i,0===Yt&&tr($e));r!==i?(n=Zt,Yt++,W.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Me)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i?(Jt=t,t=Ur("continue",{})):(Zt=t,t=i)):(Zt=t,t=i);return Gt[a]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u=73*Zt+25,l=Gt[u];if(l)return Zt=l.nextPos,l.result;if(t=Zt,(r=ir())!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(e.substr(Zt,2)===E?(s=E,Zt+=2):(s=i,0===Yt&&tr(Ee)),s===i&&(e.substr(Zt,2)===D?(s=D,Zt+=2):(s=i,0===Yt&&tr(De)),s===i&&(61===e.charCodeAt(Zt)?(s=A,Zt++):(s=i,0===Yt&&tr(xe)))),s!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();(o=ir())!==i?(Jt=t,t=Ur("+="===(f=s)?"inc":"-="===f?"dec":"assign",{dest:r,expr:o})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i;var f;return Gt[u]={nextPos:Zt,result:t},t}())===i&&(t=ir()),Gt[r]={nextPos:Zt,result:t},t)}function ir(){var e,t=73*Zt+10,r=Gt[t];return r?(Zt=r.nextPos,r.result):((e=function(){var e,t,r,n,s,a,o,u,l=73*Zt+26,f=Gt[l];if(f)return Zt=f.nextPos,f.result;if(e=Zt,(t=fr())!==i){for(r=[],n=Zt,s=[],a=dr();a!==i;)s.push(a),a=dr();if((a=yr())!==i){for(o=[],u=dr();u!==i;)o.push(u),u=dr();(u=fr())!==i?(Jt=n,n=Et(0,a,u)):(Zt=n,n=i)}else Zt=n,n=i;if(n!==i)for(;n!==i;){for(r.push(n),n=Zt,s=[],a=dr();a!==i;)s.push(a),a=dr();if((a=yr())!==i){for(o=[],u=dr();u!==i;)o.push(u),u=dr();(u=fr())!==i?(Jt=n,n=Et(0,a,u)):(Zt=n,n=i)}else Zt=n,n=i}else r=i;r!==i?(Jt=e,e=Ur("infix",{operands:[t,...(c=r).map((e=>e.term))],operators:c.map((e=>e.op))})):(Zt=e,e=i)}else Zt=e,e=i;var c;return Gt[l]={nextPos:Zt,result:e},e}())===i&&(e=fr()),Gt[t]={nextPos:Zt,result:e},e)}function fr(){var t,r=73*Zt+11,n=Gt[r];return n?(Zt=n.nextPos,n.result):((t=function(){var t,r,n,s,a,o,u,l,f,c,h=73*Zt+34,p=Gt[h];if(p)return Zt=p.nextPos,p.result;t=Zt,e.substr(Zt,2)===q?(r=q,Zt+=2):(r=i,0===Yt&&tr(Qe));if(r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=ir())!==i){if(a=[],(o=Fr())!==i)for(;o!==i;)a.push(o),o=Fr();else a=i;if(a!==i)if((o=Nr())!==i){if(u=Zt,l=[],(f=Fr())!==i)for(;f!==i;)l.push(f),f=Fr();else l=i;if(l!==i&&(f=function(){var e,t,r,n,s,a,o=73*Zt+35,u=Gt[o];if(u)return Zt=u.nextPos,u.result;if(e=Zt,(t=br())!==i){for(r=[],n=Zt,s=[],a=Fr();a!==i;)s.push(a),a=Fr();for((a=br())!==i?n=a:(Zt=n,n=i);n!==i;){for(r.push(n),n=Zt,s=[],a=Fr();a!==i;)s.push(a),a=Fr();(a=br())!==i?n=a:(Zt=n,n=i)}Jt=e,e=St(t,r)}else Zt=e,e=i;return Gt[o]={nextPos:Zt,result:e},e}())!==i?u=f:(Zt=u,u=i),u===i&&(u=null),l=Zt,f=[],(c=Fr())!==i)for(;c!==i;)f.push(c),c=Fr();else f=i;f!==i&&(c=function(){var t,r,n,s,a,o=73*Zt+37,u=Gt[o];if(u)return Zt=u.nextPos,u.result;t=Zt,e.substr(Zt,4)===T?(r=T,Zt+=4):(r=i,0===Yt&&tr(Xe));if(r!==i)if(n=Zt,Yt++,W.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Me)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();(a=Nr())!==i?(Jt=t,t=a):(Zt=t,t=i)}else Zt=t,t=i;else Zt=t,t=i;return Gt[o]={nextPos:Zt,result:t},t}())!==i?l=c:(Zt=l,l=i),l===i&&(l=null),Jt=t,t=Ur("if",{cond:s,then:o,elseif:u||[],else:l})}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;return Gt[h]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,f,c,h,p,v,g=73*Zt+58,x=Gt[g];if(x)return Zt=x.nextPos,x.result;t=Zt,e.substr(Zt,2)===Q?(r=Q,Zt+=2):(r=i,0===Yt&&tr(mt));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();for((s=jr())===i&&(s=null),a=[],o=Fr();o!==i;)a.push(o),o=Fr();if(41===e.charCodeAt(Zt)?(o=d,Zt++):(o=i,0===Yt&&tr(he)),o!==i){for(u=Zt,l=[],f=Fr();f!==i;)l.push(f),f=Fr();if(58===e.charCodeAt(Zt)?(f=b,Zt++):(f=i,0===Yt&&tr(ge)),f!==i){for(c=[],h=Fr();h!==i;)c.push(h),h=Fr();(h=$r())!==i?u=h:(Zt=u,u=i)}else Zt=u,u=i;for(u===i&&(u=null),l=[],f=Fr();f!==i;)l.push(f),f=Fr();if(123===e.charCodeAt(Zt)?(f=y,Zt++):(f=i,0===Yt&&tr(ve)),f!==i){for(c=[],h=Fr();h!==i;)c.push(h),h=Fr();for((h=ar())===i&&(h=null),p=[],v=Fr();v!==i;)p.push(v),v=Fr();125===e.charCodeAt(Zt)?(v=m,Zt++):(v=i,0===Yt&&tr(de)),v!==i?(Jt=t,t=Ur("fn",{args:s||[],ret:u},h||[])):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;return Gt[g]={nextPos:Zt,result:t},t}())===i&&(t=function(){var e,t,r,n,s=73*Zt+29,a=Gt[s];if(a)return Zt=a.nextPos,a.result;if(e=Zt,(t=cr())!==i){if(r=[],(n=mr())===i&&(n=gr())===i&&(n=xr()),n!==i)for(;n!==i;)r.push(n),(n=mr())===i&&(n=gr())===i&&(n=xr());else r=i;r!==i?(Jt=e,e=Dt(t,r)):(Zt=e,e=i)}else Zt=e,e=i;return Gt[s]={nextPos:Zt,result:e},e}())===i&&(t=cr()),Gt[r]={nextPos:Zt,result:t},t)}function cr(){var t,r,n,s,a,o,u=73*Zt+12,l=Gt[u];if(l)return Zt=l.nextPos,l.result;if((t=function(){var t,r,n,s,a,o,u,l,f,c,h,p,v,d,g,x,b,A=73*Zt+38,P=Gt[A];if(P)return Zt=P.nextPos,P.result;t=Zt,e.substr(Zt,5)===I?(r=I,Zt+=5):(r=i,0===Yt&&tr(et));if(r!==i)if(n=Zt,Yt++,W.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Me)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();if((a=ir())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(123===e.charCodeAt(Zt)?(u=y,Zt++):(u=i,0===Yt&&tr(ve)),u!==i){for(l=[],f=Fr();f!==i;)l.push(f),f=Fr();if(f=[],c=Zt,(h=ir())!==i){for(p=[],v=Fr();v!==i;)p.push(v),v=Fr();if(e.substr(Zt,2)===U?(v=U,Zt+=2):(v=i,0===Yt&&tr(tt)),v!==i){for(d=[],g=Fr();g!==i;)d.push(g),g=Fr();if((g=Nr())!==i){for(x=[],b=Fr();b!==i;)x.push(b),b=Fr();Jt=c,c=Ht(0,h,g)}else Zt=c,c=i}else Zt=c,c=i}else Zt=c,c=i;if(c!==i)for(;c!==i;)if(f.push(c),c=Zt,(h=ir())!==i){for(p=[],v=Fr();v!==i;)p.push(v),v=Fr();if(e.substr(Zt,2)===U?(v=U,Zt+=2):(v=i,0===Yt&&tr(tt)),v!==i){for(d=[],g=Fr();g!==i;)d.push(g),g=Fr();if((g=Nr())!==i){for(x=[],b=Fr();b!==i;)x.push(b),b=Fr();Jt=c,c=Ht(0,h,g)}else Zt=c,c=i}else Zt=c,c=i}else Zt=c,c=i;else f=i;if(f!==i){if(c=Zt,42===e.charCodeAt(Zt)?(h="*",Zt++):(h=i,0===Yt&&tr(Be)),h!==i){for(p=[],v=Fr();v!==i;)p.push(v),v=Fr();if(e.substr(Zt,2)===U?(v=U,Zt+=2):(v=i,0===Yt&&tr(tt)),v!==i){for(d=[],g=Fr();g!==i;)d.push(g),g=Fr();if((g=Nr())!==i){for(x=[],b=Fr();b!==i;)x.push(b),b=Fr();c=g}else Zt=c,c=i}else Zt=c,c=i}else Zt=c,c=i;for(c===i&&(c=null),h=[],p=Fr();p!==i;)h.push(p),p=Fr();125===e.charCodeAt(Zt)?(p=m,Zt++):(p=i,0===Yt&&tr(de)),p!==i?(Jt=t,t=Ur("match",{about:a,qs:f||[],default:c})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i;return Gt[A]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,f=73*Zt+39,c=Gt[f];if(c)return Zt=c.nextPos,c.result;t=Zt,e.substr(Zt,4)===z?(r=z,Zt+=4):(r=i,0===Yt&&tr(rt));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(123===e.charCodeAt(Zt)?(s=y,Zt++):(s=i,0===Yt&&tr(ve)),s!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();if((o=ar())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();125===e.charCodeAt(Zt)?(l=m,Zt++):(l=i,0===Yt&&tr(de)),l!==i?(Jt=t,t=Ur("block",{statements:o})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;return Gt[f]={nextPos:Zt,result:t},t}())===i&&(t=Ar())===i&&(t=wr())===i&&(t=kr())===i&&(t=_r())===i&&(t=Sr())===i&&(t=function(){var t,r,n,s,a,o,u,l,f,c,h,p,v,d,g=73*Zt+53,x=Gt[g];if(x)return Zt=x.nextPos,x.result;t=Zt,123===e.charCodeAt(Zt)?(r=y,Zt++):(r=i,0===Yt&&tr(ve));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(s=[],a=Zt,(o=Er())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(58===e.charCodeAt(Zt)?(l=b,Zt++):(l=i,0===Yt&&tr(ge)),l!==i){if(f=[],(c=Fr())!==i)for(;c!==i;)f.push(c),c=Fr();else f=i;if(f!==i)if((c=ir())!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();for(44===e.charCodeAt(Zt)?(p=_,Zt++):(p=i,0===Yt&&tr(ke)),p===i&&(59===e.charCodeAt(Zt)?(p=K,Zt++):(p=i,0===Yt&&tr(dt))),p===i&&(p=null),v=[],d=Fr();d!==i;)v.push(d),d=Fr();Jt=a,a=It(o,c)}else Zt=a,a=i;else Zt=a,a=i}else Zt=a,a=i}else Zt=a,a=i;for(;a!==i;)if(s.push(a),a=Zt,(o=Er())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(58===e.charCodeAt(Zt)?(l=b,Zt++):(l=i,0===Yt&&tr(ge)),l!==i){if(f=[],(c=Fr())!==i)for(;c!==i;)f.push(c),c=Fr();else f=i;if(f!==i)if((c=ir())!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();for(44===e.charCodeAt(Zt)?(p=_,Zt++):(p=i,0===Yt&&tr(ke)),p===i&&(59===e.charCodeAt(Zt)?(p=K,Zt++):(p=i,0===Yt&&tr(dt))),p===i&&(p=null),v=[],d=Fr();d!==i;)v.push(d),d=Fr();Jt=a,a=It(o,c)}else Zt=a,a=i;else Zt=a,a=i}else Zt=a,a=i}else Zt=a,a=i;125===e.charCodeAt(Zt)?(a=m,Zt++):(a=i,0===Yt&&tr(de)),a!==i?(Jt=t,t=Ut(s)):(Zt=t,t=i)}else Zt=t,t=i;return Gt[g]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,f,c,h=73*Zt+54,p=Gt[h];if(p)return Zt=p.nextPos,p.result;t=Zt,91===e.charCodeAt(Zt)?(r=N,Zt++):(r=i,0===Yt&&tr(Ge));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(s=[],a=Zt,(o=ir())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(Zt)?(l=_,Zt++):(l=i,0===Yt&&tr(ke)),l===i&&(l=null),f=[],c=Fr();c!==i;)f.push(c),c=Fr();Jt=a,a=o}else Zt=a,a=i;for(;a!==i;)if(s.push(a),a=Zt,(o=ir())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(Zt)?(l=_,Zt++):(l=i,0===Yt&&tr(ke)),l===i&&(l=null),f=[],c=Fr();c!==i;)f.push(c),c=Fr();Jt=a,a=o}else Zt=a,a=i;for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();93===e.charCodeAt(Zt)?(o=C,Zt++):(o=i,0===Yt&&tr(we)),o!==i?(Jt=t,t=zt(s)):(Zt=t,t=i)}else Zt=t,t=i;return Gt[h]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n=73*Zt+40,s=Gt[n];if(s)return Zt=s.nextPos,s.result;t=Zt,(r=function(){var t,r,n,s,a,o=73*Zt+66,u=Gt[o];if(u)return Zt=u.nextPos,u.result;if(t=Zt,Er()!==i){for(r=[],n=Zt,58===e.charCodeAt(Zt)?(s=b,Zt++):(s=i,0===Yt&&tr(ge)),s!==i&&(a=Er())!==i?n=s=[s,a]:(Zt=n,n=i);n!==i;)r.push(n),n=Zt,58===e.charCodeAt(Zt)?(s=b,Zt++):(s=i,0===Yt&&tr(ge)),s!==i&&(a=Er())!==i?n=s=[s,a]:(Zt=n,n=i);Jt=t,t=Ct()}else Zt=t,t=i;return Gt[o]={nextPos:Zt,result:t},t}())!==i&&(Jt=t,r=Ur("var",{name:r}));return t=r,Gt[n]={nextPos:Zt,result:t},t}())===i)if(t=Zt,40===e.charCodeAt(Zt)?(r=v,Zt++):(r=i,0===Yt&&tr(ce)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if((s=ir())!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();41===e.charCodeAt(Zt)?(o=d,Zt++):(o=i,0===Yt&&tr(he)),o!==i?(Jt=t,t=s):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i;return Gt[u]={nextPos:Zt,result:t},t}function hr(){var t,r=73*Zt+13,n=Gt[r];return n?(Zt=n.nextPos,n.result):((t=kr())===i&&(t=wr())===i&&(t=_r())===i&&(t=function(){var t,r,n,s,a,o,u,l,f,c,h=73*Zt+59,p=Gt[h];if(p)return Zt=p.nextPos,p.result;t=Zt,91===e.charCodeAt(Zt)?(r=N,Zt++):(r=i,0===Yt&&tr(Ge));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(s=[],a=Zt,(o=hr())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(Zt)?(l=_,Zt++):(l=i,0===Yt&&tr(ke)),l===i&&(l=null),f=[],c=Fr();c!==i;)f.push(c),c=Fr();Jt=a,a=o}else Zt=a,a=i;for(;a!==i;)if(s.push(a),a=Zt,(o=hr())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(Zt)?(l=_,Zt++):(l=i,0===Yt&&tr(ke)),l===i&&(l=null),f=[],c=Fr();c!==i;)f.push(c),c=Fr();Jt=a,a=o}else Zt=a,a=i;for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();93===e.charCodeAt(Zt)?(o=C,Zt++):(o=i,0===Yt&&tr(we)),o!==i?(Jt=t,t=zt(s)):(Zt=t,t=i)}else Zt=t,t=i;return Gt[h]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,f,c,h,p,v,d,g=73*Zt+60,x=Gt[g];if(x)return Zt=x.nextPos,x.result;t=Zt,123===e.charCodeAt(Zt)?(r=y,Zt++):(r=i,0===Yt&&tr(ve));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(s=[],a=Zt,(o=Er())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(58===e.charCodeAt(Zt)?(l=b,Zt++):(l=i,0===Yt&&tr(ge)),l!==i){if(f=[],(c=Fr())!==i)for(;c!==i;)f.push(c),c=Fr();else f=i;if(f!==i)if((c=hr())!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();for(44===e.charCodeAt(Zt)?(p=_,Zt++):(p=i,0===Yt&&tr(ke)),p===i&&(59===e.charCodeAt(Zt)?(p=K,Zt++):(p=i,0===Yt&&tr(dt))),p===i&&(p=null),v=[],d=Fr();d!==i;)v.push(d),d=Fr();Jt=a,a=It(o,c)}else Zt=a,a=i;else Zt=a,a=i}else Zt=a,a=i}else Zt=a,a=i;for(;a!==i;)if(s.push(a),a=Zt,(o=Er())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(58===e.charCodeAt(Zt)?(l=b,Zt++):(l=i,0===Yt&&tr(ge)),l!==i){if(f=[],(c=Fr())!==i)for(;c!==i;)f.push(c),c=Fr();else f=i;if(f!==i)if((c=hr())!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();for(44===e.charCodeAt(Zt)?(p=_,Zt++):(p=i,0===Yt&&tr(ke)),p===i&&(59===e.charCodeAt(Zt)?(p=K,Zt++):(p=i,0===Yt&&tr(dt))),p===i&&(p=null),v=[],d=Fr();d!==i;)v.push(d),d=Fr();Jt=a,a=It(o,c)}else Zt=a,a=i;else Zt=a,a=i}else Zt=a,a=i}else Zt=a,a=i;125===e.charCodeAt(Zt)?(a=m,Zt++):(a=i,0===Yt&&tr(de)),a!==i?(Jt=t,t=Ut(s)):(Zt=t,t=i)}else Zt=t,t=i;return Gt[g]={nextPos:Zt,result:t},t}())===i&&(t=Sr()),Gt[r]={nextPos:Zt,result:t},t)}function pr(){var t,r,n,s,a,o,u,l,f,c,h=73*Zt+14,p=Gt[h];if(p)return Zt=p.nextPos,p.result;if(t=Zt,"::"===e.substr(Zt,2)?(r="::",Zt+=2):(r=i,0===Yt&&tr(pe)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=Er())!==i){if(a=[],(o=Fr())!==i)for(;o!==i;)a.push(o),o=Fr();else a=i;if(a!==i)if(123===e.charCodeAt(Zt)?(o=y,Zt++):(o=i,0===Yt&&tr(ve)),o!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for((l=function(){var e,t,r,n,s,a,o,u,l=73*Zt+5,f=Gt[l];if(f)return Zt=f.nextPos,f.result;if(e=Zt,(t=ur())!==i){for(r=[],n=Zt,s=[],a=Tr();a!==i;)s.push(a),a=Tr();if((a=Hr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=ur())!==i?(Jt=n,n=_t(0,u)):(Zt=n,n=i)}else Zt=n,n=i;for(;n!==i;){for(r.push(n),n=Zt,s=[],a=Tr();a!==i;)s.push(a),a=Tr();if((a=Hr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=ur())!==i?(Jt=n,n=_t(0,u)):(Zt=n,n=i)}else Zt=n,n=i}Jt=e,e=St(t,r)}else Zt=e,e=i;return Gt[l]={nextPos:Zt,result:e},e}())===i&&(l=null),f=[],c=Fr();c!==i;)f.push(c),c=Fr();125===e.charCodeAt(Zt)?(c=m,Zt++):(c=i,0===Yt&&tr(de)),c!==i?(Jt=t,t=Ur("ns",{name:s,members:l})):(Zt=t,t=i)}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;return Gt[h]={nextPos:Zt,result:t},t}function vr(){var t,r,n,s,a,o,u,l,f,c=73*Zt+16,h=Gt[c];if(h)return Zt=h.nextPos,h.result;if(t=Zt,e.substr(Zt,3)===x?(r=x,Zt+=3):(r=i,0===Yt&&tr(me)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=Er())!==i){for(a=Zt,o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(58===e.charCodeAt(Zt)?(u=b,Zt++):(u=i,0===Yt&&tr(ge)),u!==i){for(l=[],f=Fr();f!==i;)l.push(f),f=Fr();(f=$r())!==i?a=f:(Zt=a,a=i)}else Zt=a,a=i;for(a===i&&(a=null),o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(61===e.charCodeAt(Zt)?(u=A,Zt++):(u=i,0===Yt&&tr(xe)),u!==i){for(l=[],f=Fr();f!==i;)l.push(f),f=Fr();(f=ir())!==i?(Jt=t,t=Ur("def",{name:s,varType:a,expr:f,mut:!1,attr:[]})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;if(t===i)if(t=Zt,"var"===e.substr(Zt,3)?(r="var",Zt+=3):(r=i,0===Yt&&tr(be)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=Er())!==i){for(a=Zt,o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(58===e.charCodeAt(Zt)?(u=b,Zt++):(u=i,0===Yt&&tr(ge)),u!==i){for(l=[],f=Fr();f!==i;)l.push(f),f=Fr();(f=$r())!==i?a=f:(Zt=a,a=i)}else Zt=a,a=i;for(a===i&&(a=null),o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(61===e.charCodeAt(Zt)?(u=A,Zt++):(u=i,0===Yt&&tr(xe)),u!==i){for(l=[],f=Fr();f!==i;)l.push(f),f=Fr();(f=ir())!==i?(Jt=t,t=function(e,t,r){return Ur("def",{name:e,varType:t,expr:r,mut:!0,attr:[]})}(s,a,f)):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;return Gt[c]={nextPos:Zt,result:t},t}function dr(){var t,r,n,s=73*Zt+27,a=Gt[s];return a?(Zt=a.nextPos,a.result):(t=Zt,92===e.charCodeAt(Zt)?(r="\\",Zt++):(r=i,0===Yt&&tr(Ne)),r!==i&&(n=Hr())!==i?t=r=[r,n]:(Zt=t,t=i),t===i&&(t=Tr()),Gt[s]={nextPos:Zt,result:t},t)}function yr(){var t,r,n,s,a=73*Zt+28,o=Gt[a];return o?(Zt=o.nextPos,o.result):(t=Zt,"||"===e.substr(Zt,2)?(r="||",Zt+=2):(r=i,0===Yt&&tr(He)),r===i&&("&&"===e.substr(Zt,2)?(r="&&",Zt+=2):(r=i,0===Yt&&tr(qe)),r===i&&("=="===e.substr(Zt,2)?(r="==",Zt+=2):(r=i,0===Yt&&tr(Fe)),r===i&&("!="===e.substr(Zt,2)?(r="!=",Zt+=2):(r=i,0===Yt&&tr(Te)),r===i&&("<="===e.substr(Zt,2)?(r="<=",Zt+=2):(r=i,0===Yt&&tr(Ie)),r===i&&(">="===e.substr(Zt,2)?(r=">=",Zt+=2):(r=i,0===Yt&&tr(Ue)),r===i&&(60===e.charCodeAt(Zt)?(r="<",Zt++):(r=i,0===Yt&&tr(ze)),r===i&&(62===e.charCodeAt(Zt)?(r=">",Zt++):(r=i,0===Yt&&tr(Re)),r===i&&(43===e.charCodeAt(Zt)?(r="+",Zt++):(r=i,0===Yt&&tr(Ze)),r===i&&(45===e.charCodeAt(Zt)?(r="-",Zt++):(r=i,0===Yt&&tr(Je)),r===i&&(42===e.charCodeAt(Zt)?(r="*",Zt++):(r=i,0===Yt&&tr(Be)),r===i&&(47===e.charCodeAt(Zt)?(r="/",Zt++):(r=i,0===Yt&&tr(Ve)),r===i&&(37===e.charCodeAt(Zt)?(r="%",Zt++):(r=i,0===Yt&&tr(Le)))))))))))))),r!==i?(n=Zt,Yt++,X.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Ye)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i?(Jt=t,t=Ct()):(Zt=t,t=i)):(Zt=t,t=i),Gt[a]={nextPos:Zt,result:t},t)}function mr(){var t,r,n,s,a,o,u=73*Zt+30,l=Gt[u];if(l)return Zt=l.nextPos,l.result;if(t=Zt,40===e.charCodeAt(Zt)?(r=v,Zt++):(r=i,0===Yt&&tr(ce)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();for((s=function(){var e,t,r,n,s,a=73*Zt+31,o=Gt[a];if(o)return Zt=o.nextPos,o.result;if(e=Zt,(t=ir())!==i){for(r=[],n=Zt,Dr()!==i&&(s=ir())!==i?(Jt=n,n=Nt(0,s)):(Zt=n,n=i);n!==i;)r.push(n),n=Zt,Dr()!==i&&(s=ir())!==i?(Jt=n,n=Nt(0,s)):(Zt=n,n=i);Jt=e,e=St(t,r)}else Zt=e,e=i;return Gt[a]={nextPos:Zt,result:e},e}())===i&&(s=null),a=[],o=Fr();o!==i;)a.push(o),o=Fr();41===e.charCodeAt(Zt)?(o=d,Zt++):(o=i,0===Yt&&tr(he)),o!==i?(Jt=t,t=Ur("callChain",{args:s||[]})):(Zt=t,t=i)}else Zt=t,t=i;return Gt[u]={nextPos:Zt,result:t},t}function gr(){var t,r,n,s,a,o,u=73*Zt+32,l=Gt[u];if(l)return Zt=l.nextPos,l.result;if(t=Zt,91===e.charCodeAt(Zt)?(r=N,Zt++):(r=i,0===Yt&&tr(Ge)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if((s=ir())!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();93===e.charCodeAt(Zt)?(o=C,Zt++):(o=i,0===Yt&&tr(we)),o!==i?(Jt=t,t=Ur("indexChain",{index:s})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i;return Gt[u]={nextPos:Zt,result:t},t}function xr(){var t,r,n,s=73*Zt+33,a=Gt[s];return a?(Zt=a.nextPos,a.result):(t=Zt,46===e.charCodeAt(Zt)?(r=".",Zt++):(r=i,0===Yt&&tr(Ke)),r!==i&&(n=Er())!==i?(Jt=t,t=Ur("propChain",{name:n})):(Zt=t,t=i),Gt[s]={nextPos:Zt,result:t},t)}function br(){var t,r,n,s,a,o,u,l=73*Zt+36,f=Gt[l];if(f)return Zt=f.nextPos,f.result;if(t=Zt,e.substr(Zt,4)===F?(r=F,Zt+=4):(r=i,0===Yt&&tr(We)),r!==i)if(n=Zt,Yt++,W.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Me)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();if((a=ir())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=Nr())!==i?(Jt=t,t={cond:a,then:u}):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i;else Zt=t,t=i;return Gt[l]={nextPos:Zt,result:t},t}function Ar(){var t,r,n,s,a,o,u=73*Zt+41,l=Gt[u];if(l)return Zt=l.nextPos,l.result;if(t=Zt,96===e.charCodeAt(Zt)?(r=R,Zt++):(r=i,0===Yt&&tr(nt)),r!==i){for(n=[],s=Zt,a=Zt,Yt++,96===e.charCodeAt(Zt)?(o=R,Zt++):(o=i,0===Yt&&tr(nt)),Yt--,o===i?a=void 0:(Zt=a,a=i),a!==i&&(o=Pr())!==i?(Jt=s,s=o):(Zt=s,s=i);s!==i;)n.push(s),s=Zt,a=Zt,Yt++,96===e.charCodeAt(Zt)?(o=R,Zt++):(o=i,0===Yt&&tr(nt)),Yt--,o===i?a=void 0:(Zt=a,a=i),a!==i&&(o=Pr())!==i?(Jt=s,s=o):(Zt=s,s=i);96===e.charCodeAt(Zt)?(s=R,Zt++):(s=i,0===Yt&&tr(nt)),s!==i?(Jt=t,t=Ur("tmpl",{tmpl:Ir(n)})):(Zt=t,t=i)}else Zt=t,t=i;return Gt[u]={nextPos:Zt,result:t},t}function Pr(){var t,r,n,s,a,o,u=73*Zt+42,l=Gt[u];if(l)return Zt=l.nextPos,l.result;if((t=function(){var t,r,n=73*Zt+43,s=Gt[n];if(s)return Zt=s.nextPos,s.result;t=Zt,e.substr(Zt,2)===Z?(r=Z,Zt+=2):(r=i,0===Yt&&tr(st));r!==i&&(Jt=t,r=qt());(t=r)===i&&(t=Zt,e.substr(Zt,2)===J?(r=J,Zt+=2):(r=i,0===Yt&&tr(at)),r!==i&&(Jt=t,r=qt()),(t=r)===i&&(t=Zt,e.substr(Zt,2)===B?(r=B,Zt+=2):(r=i,0===Yt&&tr(ot)),r!==i&&(Jt=t,r="`"),t=r));return Gt[n]={nextPos:Zt,result:t},t}())===i){if(t=Zt,123===e.charCodeAt(Zt)?(r=y,Zt++):(r=i,0===Yt&&tr(ve)),r!==i){for(n=[],s=Tr();s!==i;)n.push(s),s=Tr();if((s=ir())!==i){for(a=[],o=Tr();o!==i;)a.push(o),o=Tr();125===e.charCodeAt(Zt)?(o=m,Zt++):(o=i,0===Yt&&tr(de)),o!==i?(Jt=t,t=s):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i;t===i&&(e.length>Zt?(t=e.charAt(Zt),Zt++):(t=i,0===Yt&&tr(le)))}return Gt[u]={nextPos:Zt,result:t},t}function wr(){var t,r,n,s,a,o,u=73*Zt+44,l=Gt[u];if(l)return Zt=l.nextPos,l.result;if(t=Zt,34===e.charCodeAt(Zt)?(r=V,Zt++):(r=i,0===Yt&&tr(ut)),r!==i){for(n=[],s=Zt,a=Zt,Yt++,34===e.charCodeAt(Zt)?(o=V,Zt++):(o=i,0===Yt&&tr(ut)),Yt--,o===i?a=void 0:(Zt=a,a=i),a!==i?((o=Cr())===i&&(e.length>Zt?(o=e.charAt(Zt),Zt++):(o=i,0===Yt&&tr(le))),o!==i?(Jt=s,s=o):(Zt=s,s=i)):(Zt=s,s=i);s!==i;)n.push(s),s=Zt,a=Zt,Yt++,34===e.charCodeAt(Zt)?(o=V,Zt++):(o=i,0===Yt&&tr(ut)),Yt--,o===i?a=void 0:(Zt=a,a=i),a!==i?((o=Cr())===i&&(e.length>Zt?(o=e.charAt(Zt),Zt++):(o=i,0===Yt&&tr(le))),o!==i?(Jt=s,s=o):(Zt=s,s=i)):(Zt=s,s=i);34===e.charCodeAt(Zt)?(s=V,Zt++):(s=i,0===Yt&&tr(ut)),s!==i?(Jt=t,t=Ur("str",{value:n.join("")})):(Zt=t,t=i)}else Zt=t,t=i;return Gt[u]={nextPos:Zt,result:t},t}function Cr(){var t,r,n=73*Zt+45,s=Gt[n];return s?(Zt=s.nextPos,s.result):(t=Zt,'\\"'===e.substr(Zt,2)?(r='\\"',Zt+=2):(r=i,0===Yt&&tr(lt)),r!==i&&(Jt=t,r='"'),t=r,Gt[n]={nextPos:Zt,result:t},t)}function kr(){var t,r=73*Zt+46,n=Gt[r];return n?(Zt=n.nextPos,n.result):((t=function(){var t,r,n,s,a,o,u=73*Zt+47,l=Gt[u];if(l)return Zt=l.nextPos,l.result;t=Zt,ee.test(e.charAt(Zt))?(e.charAt(Zt),Zt++):0===Yt&&tr(it);r=[],te.test(e.charAt(Zt))?(n=e.charAt(Zt),Zt++):(n=i,0===Yt&&tr(ft));if(n!==i)for(;n!==i;)r.push(n),te.test(e.charAt(Zt))?(n=e.charAt(Zt),Zt++):(n=i,0===Yt&&tr(ft));else r=i;if(r!==i){if(n=[],re.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(ct)),s!==i)for(;s!==i;)n.push(s),re.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(ct));else n=i;if(n!==i)if(46===e.charCodeAt(Zt)?(s=H,Zt++):(s=i,0===Yt&&tr(Ke)),s!==i){if(a=[],re.test(e.charAt(Zt))?(o=e.charAt(Zt),Zt++):(o=i,0===Yt&&tr(ct)),o!==i)for(;o!==i;)a.push(o),re.test(e.charAt(Zt))?(o=e.charAt(Zt),Zt++):(o=i,0===Yt&&tr(ct));else a=i;a!==i?(Jt=t,t=Ft()):(Zt=t,t=i)}else Zt=t,t=i;else Zt=t,t=i}else Zt=t,t=i;if(t===i)if(t=Zt,ee.test(e.charAt(Zt))?(e.charAt(Zt),Zt++):0===Yt&&tr(it),re.test(e.charAt(Zt))?(r=e.charAt(Zt),Zt++):(r=i,0===Yt&&tr(ct)),r!==i)if(46===e.charCodeAt(Zt)?(n=H,Zt++):(n=i,0===Yt&&tr(Ke)),n!==i){if(s=[],re.test(e.charAt(Zt))?(a=e.charAt(Zt),Zt++):(a=i,0===Yt&&tr(ct)),a!==i)for(;a!==i;)s.push(a),re.test(e.charAt(Zt))?(a=e.charAt(Zt),Zt++):(a=i,0===Yt&&tr(ct));else s=i;s!==i?(Jt=t,t=Ft()):(Zt=t,t=i)}else Zt=t,t=i;else Zt=t,t=i;return Gt[u]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a=73*Zt+48,o=Gt[a];if(o)return Zt=o.nextPos,o.result;t=Zt,ee.test(e.charAt(Zt))?(e.charAt(Zt),Zt++):0===Yt&&tr(it);te.test(e.charAt(Zt))?(r=e.charAt(Zt),Zt++):(r=i,0===Yt&&tr(ft));if(r!==i){if(n=[],re.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(ct)),s!==i)for(;s!==i;)n.push(s),re.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(ct));else n=i;n!==i?(Jt=t,t=Tt()):(Zt=t,t=i)}else Zt=t,t=i;t===i&&(t=Zt,ee.test(e.charAt(Zt))?(e.charAt(Zt),Zt++):0===Yt&&tr(it),re.test(e.charAt(Zt))?(r=e.charAt(Zt),Zt++):(r=i,0===Yt&&tr(ct)),r!==i?(Jt=t,t=Tt()):(Zt=t,t=i));return Gt[a]={nextPos:Zt,result:t},t}()),Gt[r]={nextPos:Zt,result:t},t)}function _r(){var t,r=73*Zt+49,n=Gt[r];return n?(Zt=n.nextPos,n.result):((t=function(){var t,r,n,s,a=73*Zt+50,o=Gt[a];if(o)return Zt=o.nextPos,o.result;t=Zt,e.substr(Zt,4)===L?(r=L,Zt+=4):(r=i,0===Yt&&tr(ht));r!==i?(n=Zt,Yt++,W.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Me)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i?(Jt=t,t=Ur("bool",{value:!0})):(Zt=t,t=i)):(Zt=t,t=i);return Gt[a]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a=73*Zt+51,o=Gt[a];if(o)return Zt=o.nextPos,o.result;t=Zt,e.substr(Zt,5)===Y?(r=Y,Zt+=5):(r=i,0===Yt&&tr(pt));r!==i?(n=Zt,Yt++,W.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Me)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i?(Jt=t,t=Ur("bool",{value:!1})):(Zt=t,t=i)):(Zt=t,t=i);return Gt[a]={nextPos:Zt,result:t},t}()),Gt[r]={nextPos:Zt,result:t},t)}function Sr(){var t,r,n,s,a=73*Zt+52,o=Gt[a];return o?(Zt=o.nextPos,o.result):(t=Zt,e.substr(Zt,4)===G?(r=G,Zt+=4):(r=i,0===Yt&&tr(vt)),r!==i?(n=Zt,Yt++,W.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(Me)),Yt--,s===i?n=void 0:(Zt=n,n=i),n!==i?(Jt=t,t=Ur("null",{})):(Zt=t,t=i)):(Zt=t,t=i),Gt[a]={nextPos:Zt,result:t},t)}function Mr(){var t,r,n,s,a,o,u,l=73*Zt+55,f=Gt[l];if(f)return Zt=f.nextPos,f.result;if(t=Zt,(r=Er())!==i){for(n=Zt,s=[],a=Fr();a!==i;)s.push(a),a=Fr();if(58===e.charCodeAt(Zt)?(a=b,Zt++):(a=i,0===Yt&&tr(ge)),a!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=$r())!==i?n=u:(Zt=n,n=i)}else Zt=n,n=i;n===i&&(n=null),Jt=t,t={name:r,type:n}}else Zt=t,t=i;return Gt[l]={nextPos:Zt,result:t},t}function jr(){var e,t,r,n,s,a=73*Zt+56,o=Gt[a];if(o)return Zt=o.nextPos,o.result;if(e=Zt,(t=Mr())!==i){for(r=[],n=Zt,Dr()!==i&&(s=Mr())!==i?n=s:(Zt=n,n=i);n!==i;)r.push(n),n=Zt,Dr()!==i&&(s=Mr())!==i?n=s:(Zt=n,n=i);Jt=e,e=St(t,r)}else Zt=e,e=i;return Gt[a]={nextPos:Zt,result:e},e}function Or(){var t,r,n,s,a,o,u,l,f,c,h,p,g,x,A,P,w,C=73*Zt+57,k=Gt[C];if(k)return Zt=k.nextPos,k.result;if(t=Zt,64===e.charCodeAt(Zt)?(r="@",Zt++):(r=i,0===Yt&&tr(yt)),r!==i){for(n=[],s=Tr();s!==i;)n.push(s),s=Tr();if((s=Er())!==i){for(a=[],o=Tr();o!==i;)a.push(o),o=Tr();if(40===e.charCodeAt(Zt)?(o=v,Zt++):(o=i,0===Yt&&tr(ce)),o!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for((l=jr())===i&&(l=null),f=[],c=Fr();c!==i;)f.push(c),c=Fr();if(41===e.charCodeAt(Zt)?(c=d,Zt++):(c=i,0===Yt&&tr(he)),c!==i){for(h=Zt,p=[],g=Fr();g!==i;)p.push(g),g=Fr();if(58===e.charCodeAt(Zt)?(g=b,Zt++):(g=i,0===Yt&&tr(ge)),g!==i){for(x=[],A=Fr();A!==i;)x.push(A),A=Fr();(A=$r())!==i?h=A:(Zt=h,h=i)}else Zt=h,h=i;for(h===i&&(h=null),p=[],g=Fr();g!==i;)p.push(g),g=Fr();if(123===e.charCodeAt(Zt)?(g=y,Zt++):(g=i,0===Yt&&tr(ve)),g!==i){for(x=[],A=Fr();A!==i;)x.push(A),A=Fr();for((A=ar())===i&&(A=null),P=[],w=Fr();w!==i;)P.push(w),w=Fr();125===e.charCodeAt(Zt)?(w=m,Zt++):(w=i,0===Yt&&tr(de)),w!==i?(Jt=t,t=Rt(n,s,a,l,h,A)):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;return Gt[C]={nextPos:Zt,result:t},t}function $r(){var t,r=73*Zt+61,n=Gt[r];return n?(Zt=n.nextPos,n.result):((t=function(){var t,r,n,s,a,o,u,l,f,c,h=73*Zt+62,p=Gt[h];if(p)return Zt=p.nextPos,p.result;t=Zt,e.substr(Zt,2)===Q?(r=Q,Zt+=2):(r=i,0===Yt&&tr(mt));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();for((s=function(){var e,t,r,n,s,a=73*Zt+63,o=Gt[a];if(o)return Zt=o.nextPos,o.result;if(e=Zt,(t=$r())!==i){for(r=[],n=Zt,Dr()!==i&&(s=$r())!==i?n=s:(Zt=n,n=i);n!==i;)r.push(n),n=Zt,Dr()!==i&&(s=$r())!==i?n=s:(Zt=n,n=i);Jt=e,e=St(t,r)}else Zt=e,e=i;return Gt[a]={nextPos:Zt,result:e},e}())===i&&(s=null),a=[],o=Fr();o!==i;)a.push(o),o=Fr();if(41===e.charCodeAt(Zt)?(o=d,Zt++):(o=i,0===Yt&&tr(he)),o!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(e.substr(Zt,2)===U?(l=U,Zt+=2):(l=i,0===Yt&&tr(tt)),l!==i){for(f=[],c=Fr();c!==i;)f.push(c),c=Fr();(c=$r())!==i?(Jt=t,t=Ur("fn",{args:s||[],result:c})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;return Gt[h]={nextPos:Zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,f=73*Zt+64,c=Gt[f];if(c)return Zt=c.nextPos,c.result;if(t=Zt,(r=Er())!==i){for(n=[],s=Tr();s!==i;)n.push(s),s=Tr();if(60===e.charCodeAt(Zt)?(s="<",Zt++):(s=i,0===Yt&&tr(ze)),s!==i){for(a=[],o=Tr();o!==i;)a.push(o),o=Tr();if((o=$r())!==i){for(u=[],l=Tr();l!==i;)u.push(l),l=Tr();62===e.charCodeAt(Zt)?(l=">",Zt++):(l=i,0===Yt&&tr(Re)),l!==i?(Jt=t,t=Ur("named",{name:r,inner:o})):(Zt=t,t=i)}else Zt=t,t=i}else Zt=t,t=i}else Zt=t,t=i;t===i&&(t=Zt,(r=Er())!==i&&(Jt=t,r=function(e){return Ur("named",{name:e,inner:null})}(r)),t=r);return Gt[f]={nextPos:Zt,result:t},t}()),Gt[r]={nextPos:Zt,result:t},t)}function Er(){var t,r,n,s,a=73*Zt+65,o=Gt[a];if(o)return Zt=o.nextPos,o.result;if(t=Zt,ne.test(e.charAt(Zt))?(r=e.charAt(Zt),Zt++):(r=i,0===Yt&&tr(gt)),r!==i){for(n=[],se.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(xt));s!==i;)n.push(s),se.test(e.charAt(Zt))?(s=e.charAt(Zt),Zt++):(s=i,0===Yt&&tr(xt));Jt=t,t=Ct()}else Zt=t,t=i;return Gt[a]={nextPos:Zt,result:t},t}function Dr(){var t,r,n,s,a,o=73*Zt+67,u=Gt[o];if(u)return Zt=u.nextPos,u.result;for(t=Zt,r=[],n=Fr();n!==i;)r.push(n),n=Fr();if(44===e.charCodeAt(Zt)?(n=_,Zt++):(n=i,0===Yt&&tr(ke)),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();t=r=[r,n,s]}else Zt=t,t=i;if(t===i)if(t=[],(r=Fr())!==i)for(;r!==i;)t.push(r),r=Fr();else t=i;return Gt[o]={nextPos:Zt,result:t},t}function Nr(){var t,r,n,s,a,o,u=73*Zt+68,l=Gt[u];if(l)return Zt=l.nextPos,l.result;if(t=Zt,123===e.charCodeAt(Zt)?(r=y,Zt++):(r=i,0===Yt&&tr(ve)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();for((s=ar())===i&&(s=null),a=[],o=Fr();o!==i;)a.push(o),o=Fr();125===e.charCodeAt(Zt)?(o=m,Zt++):(o=i,0===Yt&&tr(de)),o!==i?(Jt=t,t=Ur("block",{statements:s||[]})):(Zt=t,t=i)}else Zt=t,t=i;return t===i&&(t=lr()),Gt[u]={nextPos:Zt,result:t},t}function Hr(){var t,r=73*Zt+69,n=Gt[r];return n?(Zt=n.nextPos,n.result):("\r\n"===e.substr(Zt,2)?(t="\r\n",Zt+=2):(t=i,0===Yt&&tr(bt)),t===i&&(ae.test(e.charAt(Zt))?(t=e.charAt(Zt),Zt++):(t=i,0===Yt&&tr(At))),Gt[r]={nextPos:Zt,result:t},t)}function qr(){var t,r,n=73*Zt+70,s=Gt[n];return s?(Zt=s.nextPos,s.result):(t=Zt,Yt++,e.length>Zt?(r=e.charAt(Zt),Zt++):(r=i,0===Yt&&tr(le)),Yt--,r===i?t=void 0:(Zt=t,t=i),t===i&&(t=Hr()),Gt[n]={nextPos:Zt,result:t},t)}function Fr(){var t,r=73*Zt+71,n=Gt[r];return n?(Zt=n.nextPos,n.result):(oe.test(e.charAt(Zt))?(t=e.charAt(Zt),Zt++):(t=i,0===Yt&&tr(Pt)),Gt[r]={nextPos:Zt,result:t},t)}function Tr(){var t,r=73*Zt+72,n=Gt[r];return n?(Zt=n.nextPos,n.result):(ue.test(e.charAt(Zt))?(t=e.charAt(Zt),Zt++):(t=i,0===Yt&&tr(wt)),Gt[r]={nextPos:Zt,result:t},t)}function Ir(e){let t=function(e,t){const r=[];for(let n=0;n<e.length;n++)0!=n&&t(e[n-1],e[n])?r[r.length-1].push(e[n]):r.push([e[n]]);return r}(e,((e,t)=>typeof t==typeof e));return t=t.map((e=>"string"==typeof e[0]?[e.join("")]:e)),function(e){return e.reduce(((e,t)=>e.concat(t)),[])}(t)}function Ur(e,t,r){const n={type:e};t.children=r;for(const a of Object.keys(t))void 0!==t[a]&&(n[a]=t[a]);const s=er(Jt,Zt);return n.loc={start:s.start.offset,end:s.end.offset-1},n}if((s=h())!==i&&Zt===e.length)return s;throw s!==i&&Zt<e.length&&tr({type:"end"}),a=Lt,o=Vt<e.length?e.charAt(Vt):null,l=Vt<e.length?er(Vt,Vt+1):er(Vt,Vt),new fe(fe.buildMessage(a,o),a,o,l)}function pe(e){return null!=e.chain}function ve(e,t,r){return{type:"index",target:e,index:t,loc:r}}function de(e,t,r){return{type:"prop",target:e,name:t,loc:r}}function ye(e,t){const r=t(e);switch(r.type){case"def":case"return":r.expr=ye(r.expr,t);break;case"forOf":r.items=ye(r.items,t),r.for=ye(r.for,t);break;case"for":null!=r.from&&(r.from=ye(r.from,t)),null!=r.to&&(r.to=ye(r.to,t)),null!=r.times&&(r.times=ye(r.times,t)),r.for=ye(r.for,t);break;case"loop":for(let e=0;e<r.statements.length;e++)r.statements[e]=ye(r.statements[e],t);break;case"inc":case"dec":case"assign":r.expr=ye(r.expr,t),r.dest=ye(r.dest,t);break;case"infix":for(let e=0;e<r.operands.length;e++)r.operands[e]=ye(r.operands[e],t);break;case"if":r.cond=ye(r.cond,t),r.then=ye(r.then,t);for(const e of r.elseif)e.cond=ye(e.cond,t),e.then=ye(e.then,t);null!=r.else&&(r.else=ye(r.else,t));break;case"fn":for(let e=0;e<r.children.length;e++)r.children[e]=ye(r.children[e],t);break;case"match":r.about=ye(r.about,t);for(const e of r.qs)e.q=ye(e.q,t),e.a=ye(e.a,t);null!=r.default&&(r.default=ye(r.default,t));break;case"block":for(let e=0;e<r.statements.length;e++)r.statements[e]=ye(r.statements[e],t);break;case"tmpl":for(let e=0;e<r.tmpl.length;e++){const n=r.tmpl[e];"string"!=typeof n&&(r.tmpl[e]=ye(n,t))}break;case"obj":for(const e of r.value)r.value.set(e[0],ye(e[1],t));break;case"arr":for(let e=0;e<r.value.length;e++)r.value[e]=ye(r.value[e],t);break;case"callChain":for(let e=0;e<r.args.length;e++)r.args[e]=ye(r.args[e],t);break;case"indexChain":r.index=ye(r.index,t);break;case"call":r.target=ye(r.target,t);for(let e=0;e<r.args.length;e++)r.args[e]=ye(r.args[e],t);break;case"index":r.target=ye(r.target,t),r.index=ye(r.index,t);break;case"prop":r.target=ye(r.target,t)}if(pe(r)&&null!=r.chain)for(let n=0;n<r.chain.length;n++)r.chain[n]=ye(r.chain[n],t);return r}le([l],ie.prototype,"exec",1),le([l],ie.prototype,"execFn",1),le([l],ie.prototype,"log",1),le([l],ie.prototype,"collectNs",1),le([l],ie.prototype,"collectNsMember",1),le([l],ie.prototype,"_fn",1),le([l],ie.prototype,"_eval",1),le([l],ie.prototype,"_run",1),le([l],ie.prototype,"registerAbortHandler",1),le([l],ie.prototype,"unregisterAbortHandler",1),le([l],ie.prototype,"abort",1),le([l],ie,"collectMetadata",1),function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(fe,Error),fe.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,a=this.location.source+":"+s.line+":"+s.column;if(n){var o=this.location.end,u=ce("",s.line.toString().length),l=n[s.line-1],i=s.line===o.line?o.column:l.length+1;t+="\n --\x3e "+a+"\n"+u+" |\n"+s.line+" | "+l+"\n"+u+" | "+ce("",s.column-1)+ce("",i-s.column,"^")}else t+="\n at "+a}return t},fe.buildMessage=function(e,t){var r,n={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?o(e[0])+"-"+o(e[1]):o(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function s(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+s(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+s(e)}))}function o(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+s(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+s(e)}))}function u(e){return n[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(u);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+(((r=t)?'"'+a(r)+'"':"end of input")+" found.")};const me=["null","true","false","each","for","loop","break","continue","match","if","elif","else","return","eval","var","let","fn","namespace","meta","attr","attribute","static","class","struct","module","while","import","export"];function ge(e){throw new Pe(`Reserved word "${e}" cannot be used as variable name.`)}function xe(e){switch(e.type){case"def":case"attr":case"ns":case"var":case"propChain":me.includes(e.name)&&ge(e.name);break;case"meta":null!=e.name&&me.includes(e.name)&&ge(e.name);break;case"fn":for(const t of e.args)me.includes(t.name)&&ge(t.name)}return e}function be(e){for(const t of e)ye(t,xe);return e}class Ae extends Error{constructor(e){let t="Syntax error.";e&&(t+=` ${e}`),super(t)}}class Pe extends Error{constructor(e){let t="Semantic error.";e&&(t+=` ${e}`),super(t)}}function we(e){return{type:"simple",name:e}}function Ce(e){switch(e.type){case"named":if(e.inner){const t=Ce(e.inner);return`${e.name}<${t}>`}return e.name;case"fn":return`@(${e.args.map((e=>Ce(e))).join(", ")}) => ${Ce(e.result)}`}}function ke(e){if("named"===e.type){switch(e.name){case"null":case"bool":case"num":case"str":case"any":case"void":if(null==e.inner)return we(e.name);break;case"arr":case"obj":{let t;return t=null!=e.inner?ke(e.inner):we("any"),{type:"generic",name:e.name,inners:[t]}}}throw new Pe(`Unknown type: '${Ce(e)}'`)}{const n=e.args.map((e=>ke(e)));return t=n,r=ke(e.result),{type:"fn",args:t,result:r}}var t,r}function _e(e){switch(e.type){case"def":null!=e.varType&&ke(e.varType);break;case"fn":for(const t of e.args)null!=t.type&&ke(t.type);null!=e.ret&&ke(e.ret)}return e}function Se(e){for(const t of e)ye(t,_e);return e}function Me(e){const t=[],r=[];for(const n of e)if("attr"===n.type)r.push(n);else if("def"===n.type)null==n.attr&&(n.attr=[]),n.attr.push(...r),r.splice(0,r.length),"fn"===n.expr.type&&(n.expr.children=Me(n.expr.children)),t.push(n);else{if(r.length>0)throw new Pe("invalid attribute.");switch(n.type){case"fn":n.children=Me(n.children);break;case"block":n.statements=Me(n.statements)}t.push(n)}if(r.length>0)throw new Pe("invalid attribute.");return t}function je(e){if(pe(e)&&null!=e.chain){const u=e,{chain:l}=u;let i=((e,t)=>{var r={};for(var o in e)s.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&n)for(var o of n(e))t.indexOf(o)<0&&a.call(e,o)&&(r[o]=e[o]);return r})(u,["chain"]);for(const e of l)switch(e.type){case"callChain":t=i,r=e.args,o=e.loc,i={type:"call",target:t,args:r,loc:o};break;case"indexChain":i=ve(i,e.index,e.loc);break;case"propChain":i=de(i,e.name,e.loc)}return i}var t,r,o;return e}function Oe(e){for(let t=0;t<e.length;t++)e[t]=ye(e[t],je);return e}class $e{constructor(){this.plugins=[be,Se,Me,Oe]}static parse(e){return null==$e.instance&&($e.instance=new $e),$e.instance.parse(e)}addPlugin(e){this.plugins.push(e)}parse(e){let t;try{const r=he(e,{startRule:"Preprocess"});t=he(r,{startRule:"Main"})}catch(r){if(r.location)throw r.expected?new Ae(`Line ${r.location.start.line}:${r.location.start.column}`):new Ae(`${r.message} Line ${r.location.start.line}:${r.location.start.column}`);throw r}for(const n of this.plugins)t=n(t);return t}}const Ee={id:"root"},De=x("h1",null,"AiScript (v0.11.1) Playground",-1),Ne={id:"grid1"},He={id:"editor",class:"container"},qe=k("Input"),Fe={key:0,class:"syntaxError"},Te={id:"logs",class:"container"},Ie=x("header",null,"Output",-1),Ue={class:"type"},ze={id:"grid2"},Re={id:"ast",class:"container"},Ze=x("header",null,"AST",-1),Je=x("div",{id:"bin",class:"container"},[x("header",null,"Bytecode"),x("div")],-1),Be=x("div",{id:"debugger",class:"container"},[x("header",null,"Debugger"),x("div")],-1);M({setup(e){const t=d(window.localStorage.getItem("script")||'<: "Hello, AiScript!"'),r=d(null),n=d([]),s=d(!1);y(t,(()=>{window.localStorage.setItem("script",t.value);try{r.value=$e.parse(t.value),s.value=!1}catch(e){return s.value=!0,void console.error(e)}}),{immediate:!0});const a=()=>{t.value='for (let i, 100) {\n  <: if (i % 15 == 0) "FizzBuzz"\n    elif (i % 3 == 0) "Fizz"\n    elif (i % 5 == 0) "Buzz"\n    else i\n}'},o=async()=>{n.value=[];const e=new ie({},{in:e=>new Promise((t=>{t(window.prompt(e))})),out:e=>{n.value.push({id:Math.random(),type:e.type,text:"str"===e.type||"num"===e.type?e.value:Q(e),print:!0})},log:(e,t)=>{switch(e){case"end":n.value.push({id:Math.random(),text:Q(t.val,!0),print:!1})}}});try{await e.exec(r.value)}catch(t){console.error(t),window.alert("Error: "+t)}},u=e=>_.exports.highlight(e,_.exports.languages.js,"javascript");return(e,l)=>(m(),g("div",Ee,[De,x("div",Ne,[x("div",He,[x("header",null,[qe,x("div",{class:"actions"},[x("button",{onClick:a},"FizzBuzz")])]),x("div",null,[x(b(S),{class:"code",modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value=e),highlight:u,"line-numbers":!1},null,8,["modelValue"])]),x("footer",null,[s.value?(m(),g("span",Fe,"Syntax Error!")):A("",!0),x("div",{class:"actions"},[x("button",{onClick:o},"RUN")])])]),x("div",Te,[Ie,x("div",null,[(m(!0),g(P,null,w(n.value,(e=>(m(),g("div",{class:["log",[{print:e.print},e.type]],key:e.id},[x("span",Ue,C(e.type),1),k(" "+C(e.text),1)],2)))),128))])])]),x("div",ze,[x("div",Re,[Ze,x("div",null,[x("pre",null,C(JSON.stringify(r.value,null,"\t")),1)])]),Je,Be])]))}}).mount("#app");
