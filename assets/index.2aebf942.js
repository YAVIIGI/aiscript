var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,o=(e,o)=>{for(var u in o||(o={}))r.call(o,u)&&s(e,u,o[u]);if(t)for(var u of t(o))n.call(o,u)&&s(e,u,o[u]);return e};import{a as u,v as a,s as l,l as i,t as f,b as c,i as p,r as h,w as v,o as d,c as y,d as m,u as x,e as g,F as A,f as b,g as P,h as w,p as C,P as k,j as _}from"./vendor.4481e40c.js";class S extends Error{constructor(e,t){super(e),this.info=t,Error.captureStackTrace&&Error.captureStackTrace(this,S)}}var j=Object.defineProperty,M=Object.getOwnPropertyDescriptor,O=(e,t,r,n)=>{for(var s,o=n>1?void 0:n?M(t,r):t,u=e.length-1;u>=0;u--)(s=e[u])&&(o=(n?s(t,r,o):s(o))||o);return n&&o&&j(t,r,o),o};const $=class{constructor(e=[],t,r){this.opts={},this.layerdStates=e,this.parent=t,this.name=r||(1===e.length?"<root>":"<anonymous>")}log(e,t){this.parent?this.parent.log(e,t):this.opts.log&&this.opts.log(e,t)}onUpdated(e,t){this.parent?this.parent.onUpdated(e,t):this.opts.onUpdated&&this.opts.onUpdated(e,t)}createChildScope(e=new Map,t){const r=[e,...this.layerdStates];return new $(r,this,t)}get(e){for(const t of this.layerdStates)if(t.has(e)){const r=t.get(e);return this.log("read",{var:e,val:r}),r}throw new S(`No such variable '${e}' in scope '${this.name}'`,{scope:this.layerdStates})}getAll(){const e=this.layerdStates.reduce(((e,t)=>[...e,...t]),[]);return new Map(e)}add(e,t){if(this.log("add",{var:e,val:t}),this.layerdStates[0].has(e))throw new S(`Variable '${e}' is alerady exists in scope '${this.name}'`,{scope:this.layerdStates});this.layerdStates[0].set(e,t),null==this.parent&&this.onUpdated(e,t)}assign(e,t){let r=1;for(const n of this.layerdStates){if(n.has(e))return n.set(e,t),this.log("assign",{var:e,val:t}),void(r===this.layerdStates.length&&this.onUpdated(e,t));r++}throw new S(`No such variable '${e}' in scope '${this.name}'`,{scope:this.layerdStates})}};let E=$;O([u],E.prototype,"log",1),O([u],E.prototype,"onUpdated",1),O([u],E.prototype,"createChildScope",1),O([u],E.prototype,"get",1),O([u],E.prototype,"getAll",1),O([u],E.prototype,"add",1),O([u],E.prototype,"assign",1);const N={type:"null"},D={type:"bool",value:!0},H={type:"bool",value:!1},I=e=>({type:"num",value:e}),q=e=>({type:"str",value:e}),F=e=>({type:"bool",value:e}),U=e=>({type:"obj",value:e}),z=e=>({type:"arr",value:e}),T=e=>({type:"fn",native:e});function R(e){if("bool"!==e.type)throw new S(`Expect boolean, but got ${e.type}.`)}function J(e){if("fn"!==e.type)throw new S(`Expect function, but got ${e.type}.`)}function Z(e){if("str"!==e.type)throw new S(`Expect string, but got ${e.type}.`)}function B(e){if("num"!==e.type)throw new S(`Expect number, but got ${e.type}.`)}function V(e){if("obj"!==e.type)throw new S(`Expect object, but got ${e.type}.`)}function L(e){if("arr"!==e.type)throw new S(`Expect array, but got ${e.type}.`)}function Y(e,t){return"fn"!==e.type&&"fn"!==t.type&&("null"===e.type&&"null"===t.type||"null"!==e.type&&"null"!==t.type&&e.value===t.value)}function G(e,t=!1){if(t){if("num"===e.type)return e.value;if("bool"===e.type)return e.value?"true":"false";if("str"===e.type)return`"${e.value}"`;if("arr"===e.type)return`[${e.value.map((e=>G(e,!0))).join(", ")}]`;if("null"===e.type)return"(null)"}const r="num"===e.type||"bool"===e.type?e.value:"str"===e.type?`"${e.value}"`:"fn"===e.type||"obj"===e.type?"...":"null"===e.type?"":null;return`${e.type}<${r}>`}function K(e){switch(e.type){case"arr":return e.value.map((e=>K(e)));case"bool":return e.value;case"null":return null;case"num":return e.value;case"obj":{const t={};for(const[r,n]of e.value.entries())t[r]=K(n);return t}case"str":return e.value;default:return}}function Q(e){if(null===e)return N;if("boolean"==typeof e)return F(e);if("string"==typeof e)return q(e);if("number"==typeof e)return I(e);if(Array.isArray(e))return z(e.map((e=>Q(e))));if("object"==typeof e){const t=new Map;for(const[r,n]of Object.entries(e))t.set(r,Q(n));return U(t)}return N}const W={help:q("SEE: https://github.com/syuilo/aiscript/blob/master/docs/get-started.md"),"Core:v":q("0.11.1"),"Core:ai":q("kawaii"),"Core:not":T((([e])=>(R(e),e.value?H:D))),"Core:eq":T((([e,t])=>Y(e,t)?D:H)),"Core:neq":T((([e,t])=>Y(e,t)?H:D)),"Core:and":T((([e,t])=>(R(e),R(t),e.value&&t.value?D:H))),"Core:or":T((([e,t])=>(R(e),R(t),e.value||t.value?D:H))),"Core:add":T((([e,t])=>(B(e),B(t),I(e.value+t.value)))),"Core:sub":T((([e,t])=>(B(e),B(t),I(e.value-t.value)))),"Core:mul":T((([e,t])=>(B(e),B(t),I(e.value*t.value)))),"Core:div":T((([e,t])=>{B(e),B(t);const r=e.value/t.value;if(isNaN(r))throw new S("Invalid operation.");return I(r)})),"Core:mod":T((([e,t])=>(B(e),B(t),I(e.value%t.value)))),"Core:gt":T((([e,t])=>(B(e),B(t),e.value>t.value?D:H))),"Core:lt":T((([e,t])=>(B(e),B(t),e.value<t.value?D:H))),"Core:gteq":T((([e,t])=>(B(e),B(t),e.value>=t.value?D:H))),"Core:lteq":T((([e,t])=>(B(e),B(t),e.value<=t.value?D:H))),"Core:type":T((([e])=>q(e.type))),"Core:to_str":T((([e])=>"str"===e.type?e:"num"===e.type?q(e.value.toString()):q("?"))),"Core:range":T((([e,t])=>(B(e),B(t),e.value<t.value?z(Array.from({length:t.value-e.value+1},((t,r)=>I(r+e.value)))):e.value>t.value?z(Array.from({length:e.value-t.value+1},((t,r)=>I(e.value-r)))):z([e])))),"Util:uuid":T((()=>q(a()))),"Json:stringify":T((([e])=>q(JSON.stringify(K(e))))),"Json:parse":T((([e])=>(Z(e),Q(JSON.parse(e.value))))),"Date:now":T((()=>I(Date.now()))),"Date:year":T((()=>I((new Date).getFullYear()))),"Date:month":T((()=>I((new Date).getMonth()+1))),"Date:day":T((()=>I((new Date).getDate()))),"Date:hour":T((()=>I((new Date).getHours()))),"Date:minute":T((()=>I((new Date).getMinutes()))),"Date:second":T((()=>I((new Date).getSeconds()))),"Date:parse":T((([e])=>(Z(e),I(new Date(e.value).getTime())))),"Math:PI":I(Math.PI),"Math:sin":T((([e])=>(B(e),I(Math.sin(e.value))))),"Math:cos":T((([e])=>(B(e),I(Math.cos(e.value))))),"Math:abs":T((([e])=>(B(e),I(Math.abs(e.value))))),"Math:sqrt":T((([e])=>{B(e);const t=Math.sqrt(e.value);if(isNaN(t))throw new S("Invalid operation.");return I(t)})),"Math:round":T((([e])=>(B(e),I(Math.round(e.value))))),"Math:floor":T((([e])=>(B(e),I(Math.floor(e.value))))),"Math:min":T((([e,t])=>(B(e),B(t),I(Math.min(e.value,t.value))))),"Math:max":T((([e,t])=>(B(e),B(t),I(Math.max(e.value,t.value))))),"Math:rnd":T((([e,t])=>e&&"num"===e.type&&t&&"num"===t.type?I(Math.floor(Math.random()*(t.value-e.value+1)+e.value)):I(Math.random()))),"Math:gen_rng":T((([e])=>{if("num"!==e.type&&"str"!==e.type)return N;const t=l(e.value.toString());return T((([e,r])=>e&&"num"===e.type&&r&&"num"===r.type?I(Math.floor(t()*(r.value-e.value+1)+e.value)):I(t())))})),"Num:to_hex":T((([e])=>(B(e),q(e.value.toString(16))))),"Num:from_hex":T((([e])=>(Z(e),I(parseInt(e.value,16))))),"Str:lf":q("\n"),"Str:to_num":T((([e])=>{if("num"===e.type)return e;if("str"===e.type){const t=parseInt(e.value,10);return isNaN(t)?N:I(t)}return N})),"Str:len":T((([e])=>"str"!==e.type?I(0):I(i(e.value)))),"Str:pick":T((([e,t])=>{Z(e),B(t);const r=f(e.value)[t.value-1];return r?q(r):N})),"Str:incl":T((([e,t])=>(Z(e),Z(t),e.value.includes(t.value)?D:H))),"Str:slice":T((([e,t,r])=>(Z(e),B(t),B(r),q(c(e.value,t.value-1,r.value-1))))),"Str:split":T((([e,t])=>(Z(e),t&&Z(t),z(t?e.value.split(t?t.value:"").map((e=>q(e))):f(e.value).map((e=>q(e))))))),"Str:replace":T((([e,t,r])=>(Z(e),Z(t),Z(r),q(e.value.split(t.value).join(r.value))))),"Str:index_of":T((([e,t])=>(Z(e),Z(t),I(p(e.value,t.value)+1)))),"Str:trim":T((([e])=>(Z(e),q(e.value.trim())))),"Str:upper":T((([e])=>(Z(e),q(e.value.toUpperCase())))),"Str:lower":T((([e])=>(Z(e),q(e.value.toLowerCase())))),"Arr:len":T((([e])=>"arr"!==e.type?I(0):I(e.value.length))),"Arr:push":T((([e,t])=>(L(e),e.value.push(t),N))),"Arr:unshift":T((([e,t])=>(L(e),e.value.unshift(t),N))),"Arr:pop":T((([e])=>(L(e),e.value.pop()))),"Arr:shift":T((([e])=>(L(e),e.value.shift()))),"Arr:concat":T((([e,t])=>(L(e),L(t),z(e.value.concat(t.value))))),"Arr:join":T((([e,t])=>(L(e),t&&Z(t),q(e.value.map((e=>"str"===e.type?e.value:"")).join(t?t.value:""))))),"Arr:slice":T((([e,t,r])=>(L(e),B(t),B(r),z(e.value.slice(t.value-1,r.value-1))))),"Arr:incl":T((([e,t])=>{if(L(e),"str"!==t.type&&"num"!==t.type&&"bool"!==t.type&&"null"!==t.type)return H;return(r=e,r.value.map((e=>"str"===e.type||"num"===e.type||"bool"===e.type?e.value:"null"===e.type?null:Symbol()))).includes("null"===t.type?null:t.value)?D:H;var r})),"Arr:map":T((async([e,t],r)=>{L(e),J(t);const n=e.value.map((async(e,n)=>await r.call(t,[e,I(n+1)])));return z(await Promise.all(n))})),"Arr:filter":T((async([e,t],r)=>{L(e),J(t);const n=[];for(let s=0;s<e.value.length;s++){const o=e.value[s],u=await r.call(t,[o,I(s+1)]);R(u),u.value&&n.push(o)}return z(n)})),"Arr:reduce":T((async([e,t,r],n)=>{L(e),J(t);const s=null!=r;let o=s?r:e.value[0];for(let u=s?0:1;u<e.value.length;u++){const r=e.value[u];o=await n.call(t,[o,r,I(u+1)])}return o})),"Arr:find":T((async([e,t],r)=>{L(e),J(t);for(let n=0;n<e.value.length;n++){const s=e.value[n],o=await r.call(t,[s,I(n+1)]);if(R(o),o.value)return s}return N})),"Arr:reverse":T((([e])=>(L(e),e.value.reverse(),N))),"Arr:copy":T((async([e])=>(L(e),z([...e.value])))),"Obj:keys":T((([e])=>(V(e),z(Array.from(e.value.keys()).map((e=>q(e))))))),"Obj:kvs":T((([e])=>(V(e),z(Array.from(e.value.entries()).map((([e,t])=>z([q(e),t]))))))),"Obj:get":T((([e,t])=>(V(e),Z(t),e.value.get(t.value)||N))),"Obj:set":T((([e,t,r])=>(V(e),Z(t),e.value.set(t.value,r),N))),"Obj:has":T((([e,t])=>(V(e),Z(t),F(e.value.has(t.value))))),"Obj:copy":T((([e])=>(V(e),U(new Map(e.value))))),"Async:interval":T((async([e,t,r],n)=>{B(e),J(t),r&&R(r),r&&n.call(t,[]);const s=setInterval((()=>{n.call(t,[])}),e.value),o=()=>{clearInterval(s)};return n.registerAbortHandler(o),T((([],e)=>{clearInterval(s),e.unregisterAbortHandler(o)}))})),"Async:timeout":T((async([e,t],r)=>{B(e),J(t);const n=setTimeout((()=>{r.call(t,[])}),e.value),s=()=>{clearTimeout(n)};return r.registerAbortHandler(s),T((([],e)=>{clearTimeout(n),e.unregisterAbortHandler(s)}))}))};function X(e,t,r){return{type:"infixtree",opInfo:e,left:t,right:r}}function ee(e,t,r){if("infixtree"!==e.type)return X(t,e,r);if(e.opInfo.prec>=t.prec)return X(t,e,r);const{opInfo:n,left:s,right:o}=e;return X(n,s,ee(o,t,r))}const te={"+":{func:"Core:add",prec:6},"-":{func:"Core:sub",prec:6},"*":{func:"Core:mul",prec:7},"/":{func:"Core:div",prec:7},"%":{func:"Core:mod",prec:7},"==":{func:"Core:eq",prec:4},"!=":{func:"Core:neq",prec:4},"&&":{func:"Core:and",prec:3},"||":{func:"Core:or",prec:2},"<":{func:"Core:lt",prec:4},">":{func:"Core:gt",prec:4},"<=":{func:"Core:lteq",prec:4},">=":{func:"Core:gteq",prec:4}};function re(e){return"infixtree"!==e.type?e:{type:"call",name:e.opInfo.func,args:[re(e.left),re(e.right)]}}function ne(e){const t=e.operators.map((e=>function(e){const t=te[e];if(null==t)throw new S(`No such operator: ${e}.`);return t}(e)));let r=X(t[0],e.operands[0],e.operands[1]);for(let n=1;n<t.length;n++)r=ee(r,t[n],e.operands[n+1]);return re(r)}var se=Object.defineProperty,oe=Object.getOwnPropertyDescriptor,ue=(e,t,r,n)=>{for(var s,o=n>1?void 0:n?oe(t,r):t,u=e.length-1;u>=0;u--)(s=e[u])&&(o=(n?s(t,r,o):s(o))||o);return n&&o&&se(t,r,o),o};class ae{constructor(e,t){this.stepCount=0,this.stop=!1,this.abortHandlers=[],this.opts=t||{};const r={print:T((e=>{this.opts.out&&this.opts.out(e[0])})),readline:T((async e=>{const t=e[0];if(Z(t),null==this.opts.in)return N;const r=await this.opts.in(t.value);return q(r)}))};this.vars=o(o(o({},e),W),r),this.scope=new E([new Map(Object.entries(this.vars))]),this.scope.opts.log=(e,t)=>{switch(e){case"add":this.log("var:add",t);break;case"read":this.log("var:read",t);break;case"write":this.log("var:write",t)}}}async exec(e){if(null==e||0===e.length)return;await this.collectNs(e);const t=await this._run(e,this.scope);this.log("end",{val:t})}async execFn(e,t){return this._fn(e,t)}static collectMetadata(e){if(null==e||0===e.length)return;function t(e){switch(e.type){case"arr":return e.value.map((e=>t(e)));case"bool":return e.value;case"null":return null;case"num":return e.value;case"obj":{const r={};for(const[n,s]of e.value.entries())r[n]=t(s);return r}case"str":return e.value}}const r=new Map;for(const n of e)switch(n.type){case"meta":r.set(n.name,t(n.value))}return r}log(e,t){this.opts.log&&this.opts.log(e,t)}async collectNs(e){for(const t of e)switch(t.type){case"ns":await this.collectNsMember(t)}}async collectNsMember(e){const t=this.scope.createChildScope();for(const r of e.members)switch(r.type){case"def":{const n=await this._eval(r.expr,t);t.add(r.name,n),this.scope.add(e.name+":"+r.name,n);break}case"ns":break;default:throw new Error("invalid ns member type: "+r.type)}}async _fn(e,t){if(e.native){return await Promise.resolve(e.native(t,{call:this._fn,registerAbortHandler:this.registerAbortHandler,unregisterAbortHandler:this.unregisterAbortHandler}))||N}{const n=new Map;for(let r=0;r<(e.args||[]).length;r++)n.set(e.args[r],t[r]);const s=e.scope.createChildScope(n);return"return"===(r=await this._run(e.statements,s)).type?r.value:r}var r}async _eval(e,t){if(this.stop)return N;if(this.log("node",{node:e}),this.stepCount++,this.opts.maxStep&&this.stepCount>this.opts.maxStep)throw new S("max step exceeded");switch(e.type){case"call":{const r=t.get(e.name);J(r);const n=await Promise.all(e.args.map((async e=>await this._eval(e,t))));return this._fn(r,n)}case"if":{const r=await this._eval(e.cond,t);if(R(r),r.value)return this._eval(e.then,t);if(e.elseif&&e.elseif.length>0){for(const r of e.elseif){const e=await this._eval(r.cond,t);if(R(e),e.value)return this._eval(r.then,t)}if(e.else)return this._eval(e.else,t)}else if(e.else)return this._eval(e.else,t);return N}case"match":{const r=await this._eval(e.about,t);for(const n of e.qs){if(Y(r,await this._eval(n.q,t)))return await this._eval(n.a,t)}return e.default?await this._eval(e.default,t):N}case"loop":for(;;){const r=await this._run(e.statements,t.createChildScope());if("break"===r.type)break;if("return"===r.type)return r.value}return N;case"for":if(e.times){const r=await this._eval(e.times,t);B(r);for(let n=1;n<r.value+1;n++){const r=await this._eval(e.for,t);if("break"===r.type)break;if("return"===r.type)return r.value}}else{const r=await this._eval(e.from,t),n=await this._eval(e.to,t);B(r),B(n);for(let s=r.value+1;s<n.value+1;s++){const r=await this._eval(e.for,t.createChildScope(new Map([[e.var,I(s)]])));if("break"===r.type)break;if("return"===r.type)return r.value}}return N;case"forOf":{const r=await this._eval(e.items,t);L(r);for(const n of r.value)await this._eval(e.for,t.createChildScope(new Map([[e.var,n]])));return N}case"def":{const r=await this._eval(e.expr,t);if(e.attr.length>0){const n=[];for(const r of e.attr)n.push({name:r.name,value:await this._eval(r.value,t)});r.attr=n}return t.add(e.name,r),N}case"var":return t.get(e.name);case"assign":return t.assign(e.name,await this._eval(e.expr,t)),N;case"propAssign":{let r=t.get(e.obj);const n=e.path[e.path.length-1];for(const t of e.path.slice(0,e.path.length-1)){if(V(r),!r.value.has(t)){r=N;break}r=r.value.get(t)}return V(r),r.value.set(n,await this._eval(e.expr,t)),N}case"indexAssign":{const r=t.get(e.arr);L(r);const n=await this._eval(e.i,t);return B(n),r.value[n.value-1]=await this._eval(e.expr,t),N}case"inc":{const r=t.get(e.name);B(r);const n=await this._eval(e.expr,t);return B(n),r.value+=n.value,N}case"dec":{const r=t.get(e.name);B(r);const n=await this._eval(e.expr,t);return B(n),r.value-=n.value,N}case"null":return N;case"bool":return F(e.value);case"num":return I(e.value);case"str":return q(e.value);case"arr":return z(await Promise.all(e.value.map((async e=>await this._eval(e,t)))));case"obj":{const r=new Map;for(const n of e.value.keys())r.set(n,await this._eval(e.value.get(n),t));return U(r)}case"prop":{let r=t.get(e.obj);for(const t of e.path){if(V(r),!r.value.has(t)){r=N;break}r=r.value.get(t)}return r}case"propCall":{let r=t.get(e.obj);for(const t of e.path){if(V(r),!r.value.has(t)){r=N;break}r=r.value.get(t)}J(r);const n=await Promise.all(e.args.map((async e=>await this._eval(e,t))));return this._fn(r,n)}case"index":{const r=t.get(e.arr);L(r);const n=await this._eval(e.i,t);return B(n),r.value[n.value-1]}case"fn":return((e,t,r)=>({type:"fn",args:e,statements:t,scope:r}))(e.args.map((e=>e.name)),e.children,t);case"block":return this._run(e.statements,t.createChildScope());case"tmpl":{let r="";for(const n of e.tmpl)if("string"==typeof n)r+=n;else{const e=await this._eval(n,t);let s="";"str"===e.type?s=e.value:"num"===e.type&&(s=e.value.toString()),r+=s}return q(r)}case"infix":return this._eval(ne(e),t);case"return":{const r=await this._eval(e.expr,t);return this.log("block:return",{scope:t.name,val:r}),{type:"return",value:r}}case"break":return this.log("block:break",{scope:t.name}),{type:"break",value:null};case"continue":return this.log("block:continue",{scope:t.name}),{type:"continue",value:null};case"ns":case"meta":return N;default:throw new Error("invalid node type")}}async _run(e,t){this.log("block:enter",{scope:t.name});let r=N;for(let n=0;n<e.length;n++){const s=e[n];if(r=await this._eval(s,t),"return"===r.type)return this.log("block:return",{scope:t.name,val:r.value}),r;if("break"===r.type)return this.log("block:break",{scope:t.name}),r;if("continue"===r.type)return this.log("block:continue",{scope:t.name}),r}return this.log("block:leave",{scope:t.name,val:r}),r}registerAbortHandler(e){this.abortHandlers.push(e)}unregisterAbortHandler(e){this.abortHandlers=this.abortHandlers.filter((t=>t!==e))}abort(){this.stop=!0;for(const e of this.abortHandlers)e();this.abortHandlers=[]}}function le(e,t,r,n){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,le.prototype),s.expected=t,s.found=r,s.location=n,s.name="SyntaxError",s}function ie(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function fe(e,t){var r,n,s,o,u={},a=(t=void 0!==t?t:{}).grammarSource,l={Entry:Vt,Core:function(){var e,t,r,n,s,o=77*Nt+3,a=Ut[o];if(a)return Nt=a.nextPos,a.result;e=Nt,t=[],r=Cr();for(;r!==u;)t.push(r),r=Cr();(r=Yt())===u&&(r=null);n=[],s=Cr();for(;s!==u;)n.push(s),s=Cr();return Dt=e,e=dt(r),Ut[o]={nextPos:Nt,result:e},e}},i=Vt,f="//",c="(",p=")",h="{",v="}",d="###",y="let",m=":",x="=",g="<:",A="#[",b="]",P="each",w=",",C="for",k="return",_="loop",S="break",j="continue",M=".",O="[",$="+=",E="-=",N="=>",D="if",H="elif",I="else",q="match",F="`",U="\\{",z="\\}",T="\\`",R='"',J="true",Z="false",B="null",V=";",L="->",Y="|",G=/^[A-Z0-9_:]/i,K=/^[\-+*\/%&|=~<>!?]/,Q=/^[+\-]/,W=/^[1-9]/,X=/^[0-9]/,ee=/^[A-Z_]/i,te=/^[A-Z0-9_]/i,re=/^[\r\n]/,ne=/^[ \t\r\n]/,se=/^[ \t]/,oe={type:"any"},ue=Tt("//",!1),ae=Tt("(",!1),ie=Tt(")",!1),ce=Tt("::",!1),pe=Tt("{",!1),he=Tt("}",!1),ve=Tt("###",!1),de=Tt("let",!1),ye=Tt(":",!1),me=Tt("=",!1),xe=Tt("var",!1),ge=Tt("<:",!1),Ae=Tt("#[",!1),be=Tt("]",!1),Pe=Tt("each",!1),we=Tt(",",!1),Ce=Tt("for",!1),ke=Tt("return",!1),_e=Tt("loop",!1),Se=Tt("break",!1),je=Rt([["A","Z"],["0","9"],"_",":"],!1,!0),Me=Tt("continue",!1),Oe=Tt(".",!1),$e=Tt("[",!1),Ee=Tt("+=",!1),Ne=Tt("-=",!1),De=Tt("\\",!1),He=Tt("<<<",!1),Ie=Tt("=>",!1),qe=Rt(["-","+","*","/","%","&","|","=","~","<",">","!","?"],!1,!1),Fe=Tt("if",!1),Ue=Tt("elif",!1),ze=Tt("else",!1),Te=Tt("match",!1),Re=Tt("*",!1),Je=Tt("`",!1),Ze=Tt("\\{",!1),Be=Tt("\\}",!1),Ve=Tt("\\`",!1),Le=Tt('"',!1),Ye=Tt('\\"',!1),Ge=Rt(["+","-"],!1,!1),Ke=Rt([["1","9"]],!1,!1),Qe=Rt([["0","9"]],!1,!1),We=Tt("true",!1),Xe=Tt("false",!1),et=Tt("null",!1),tt=Tt(";",!1),rt=Tt("fn",!1),nt=Tt("->",!1),st=Tt("|",!1),ot=Tt("<",!1),ut=Tt(">",!1),at=Rt([["A","Z"],"_"],!1,!0),lt=Rt([["A","Z"],["0","9"],"_"],!1,!0),it=Tt("\r\n",!1),ft=Rt(["\r","\n"],!1,!1),ct=Rt([" ","\t","\r","\n"],!1,!1),pt=Rt([" ","\t"],!1,!1),ht=function(e){return fe(e.join(""),(t="Core")?{startRule:t}:{});var t},vt=function(){return zt()},dt=function(e){return e||[]},yt=function(e,t){return t},mt=function(e,t){return[e,...t]},xt=function(e,t,r){return Sr("forOf",{var:e,items:t,for:r})},gt=function(e,t){return t},At=function(e,t,r,n){return Sr("for",{var:e,from:t||Sr("num",{value:0}),to:r,for:n})},bt=function(e,t){return Sr("for",{times:e,for:t})},Pt=function(e,t){return t},wt=function(e,t,r){return{o:t,t:r}},Ct=function(e,t,r){return{q:t,a:r}},kt=function(e,t){return t},_t=function(){return zt()[1]},St=function(){return Sr("num",{value:parseFloat(zt())})},jt=function(){return Sr("num",{value:parseInt(zt(),10)})},Mt=function(e,t){return{k:e,v:t}},Ot=function(e){const t=new Map;for(const r of e)t.set(r.k,r.v);return Sr("obj",{value:t})},$t=function(e){return Sr("arr",{value:e})},Et=function(e,t,r,n,s){return t.length&&function(e,t){throw t=void 0!==t?t:Zt(Dt,Nt),function(e,t){return new le(e,null,null,t)}(e,t)}("Cannot use spaces after the function name."),Sr("def",{name:e,expr:Sr("fn",{args:r||[],ret:n},s||[]),mut:!1,attr:[]})},Nt=0,Dt=0,Ht=[{line:1,column:1}],It=0,qt=[],Ft=0,Ut={};if("startRule"in t){if(!(t.startRule in l))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=l[t.startRule]}function zt(){return e.substring(Dt,Nt)}function Tt(e,t){return{type:"literal",text:e,ignoreCase:t}}function Rt(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Jt(t){var r,n=Ht[t];if(n)return n;for(r=t-1;!Ht[r];)r--;for(n={line:(n=Ht[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ht[t]=n,n}function Zt(e,t){var r=Jt(e),n=Jt(t);return{source:a,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Bt(e){Nt<It||(Nt>It&&(It=Nt,qt=[]),qt.push(e))}function Vt(){var e,t,r,n=77*Nt+0,s=Ut[n];if(s)return Nt=s.nextPos,s.result;for(e=Nt,t=[],r=Lt();r!==u;)t.push(r),r=Lt();return Dt=e,e=t=ht(t),Ut[n]={nextPos:Nt,result:e},e}function Lt(){var t,r,n=77*Nt+1,s=Ut[n];return s?(Nt=s.nextPos,s.result):(t=Nt,(r=lr())!==u&&(Dt=t,r=vt()),(t=r)===u&&(t=Nt,(r=fr())!==u&&(Dt=t,r=vt()),(t=r)===u&&(t=Nt,(r=function(){var t,r,n,s,o,a,l=77*Nt+2,i=Ut[l];if(i)return Nt=i.nextPos,i.result;t=Nt,e.substr(Nt,2)===f?(r=f,Nt+=2):(r=u,0===Ft&&Bt(ue));if(r!==u){for(n=[],s=Nt,o=Nt,Ft++,a=wr(),Ft--,a===u?o=void 0:(Nt=o,o=u),o!==u?(e.length>Nt?(a=e.charAt(Nt),Nt++):(a=u,0===Ft&&Bt(oe)),a!==u?s=o=[o,a]:(Nt=s,s=u)):(Nt=s,s=u);s!==u;)n.push(s),s=Nt,o=Nt,Ft++,a=wr(),Ft--,a===u?o=void 0:(Nt=o,o=u),o!==u?(e.length>Nt?(a=e.charAt(Nt),Nt++):(a=u,0===Ft&&Bt(oe)),a!==u?s=o=[o,a]:(Nt=s,s=u)):(Nt=s,s=u);t=r=[r,n]}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}())!==u&&(Dt=t,r=""),(t=r)===u&&(e.length>Nt?(t=e.charAt(Nt),Nt++):(t=u,0===Ft&&Bt(oe))))),Ut[n]={nextPos:Nt,result:t},t)}function Yt(){var e,t,r,n,s,o,a,l,i=77*Nt+4,f=Ut[i];if(f)return Nt=f.nextPos,f.result;if(e=Nt,(t=Kt())!==u){for(r=[],n=Nt,s=[],o=kr();o!==u;)s.push(o),o=kr();if((o=Pr())!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();(l=Kt())!==u?(Dt=n,n=yt(0,l)):(Nt=n,n=u)}else Nt=n,n=u;for(;n!==u;){for(r.push(n),n=Nt,s=[],o=kr();o!==u;)s.push(o),o=kr();if((o=Pr())!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();(l=Kt())!==u?(Dt=n,n=yt(0,l)):(Nt=n,n=u)}else Nt=n,n=u}Dt=e,e=mt(t,r)}else Nt=e,e=u;return Ut[i]={nextPos:Nt,result:e},e}function Gt(){var e,t,r,n,s,o,a,l,i=77*Nt+6,f=Ut[i];if(f)return Nt=f.nextPos,f.result;if(e=Nt,(t=Wt())!==u){for(r=[],n=Nt,s=[],o=kr();o!==u;)s.push(o),o=kr();if((o=Pr())!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();(l=Wt())!==u?(Dt=n,n=yt(0,l)):(Nt=n,n=u)}else Nt=n,n=u;for(;n!==u;){for(r.push(n),n=Nt,s=[],o=kr();o!==u;)s.push(o),o=kr();if((o=Pr())!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();(l=Wt())!==u?(Dt=n,n=yt(0,l)):(Nt=n,n=u)}else Nt=n,n=u}Dt=e,e=mt(t,r)}else Nt=e,e=u;return Ut[i]={nextPos:Nt,result:e},e}function Kt(){var t,r=77*Nt+7,n=Ut[r];return n?(Nt=n.nextPos,n.result):((t=rr())===u&&(t=function(){var t,r,n,s,o,a,l=77*Nt+15,i=Ut[l];if(i)return Nt=i.nextPos,i.result;t=Nt,e.substr(Nt,3)===d?(r=d,Nt+=3):(r=u,0===Ft&&Bt(ve));if(r!==u){for(n=[],s=kr();s!==u;)n.push(s),s=kr();if((s=gr())!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();(a=tr())!==u?(Dt=t,t=Sr("meta",{name:s,value:a})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;if(t===u)if(t=Nt,e.substr(Nt,3)===d?(r=d,Nt+=3):(r=u,0===Ft&&Bt(ve)),r!==u){for(n=[],s=kr();s!==u;)n.push(s),s=kr();(s=tr())!==u?(Dt=t,t=function(e){return Sr("meta",{name:null,value:e})}(s)):(Nt=t,t=u)}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}())===u&&(t=Wt()),Ut[r]={nextPos:Nt,result:t},t)}function Qt(){var e,t=77*Nt+8,r=Ut[t];return r?(Nt=r.nextPos,r.result):((e=nr())===u&&(e=mr())===u&&(e=rr()),Ut[t]={nextPos:Nt,result:e},e)}function Wt(){var t,r=77*Nt+9,n=Ut[r];return n?(Nt=n.nextPos,n.result):((t=nr())===u&&(t=mr())===u&&(t=function(){var t,r,n,s,o=77*Nt+17,a=Ut[o];if(a)return Nt=a.nextPos,a.result;t=Nt,e.substr(Nt,2)===g?(r=g,Nt+=2):(r=u,0===Ft&&Bt(ge));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();(s=Xt())!==u?(Dt=t,t=Sr("call",{name:"print",args:[s]})):(Nt=t,t=u)}else Nt=t,t=u;return Ut[o]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o=77*Nt+21,a=Ut[o];if(a)return Nt=a.nextPos,a.result;t=Nt,e.substr(Nt,6)===k?(r=k,Nt+=6):(r=u,0===Ft&&Bt(ke));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();(s=Xt())!==u?(Dt=t,t=Sr("return",{expr:s})):(Nt=t,t=u)}else Nt=t,t=u;return Ut[o]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i=77*Nt+18,f=Ut[i];if(f)return Nt=f.nextPos,f.result;t=Nt,e.substr(Nt,2)===A?(r=A,Nt+=2):(r=u,0===Ft&&Bt(Ae));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if((s=gr())!==u){for(o=Nt,a=[],l=Cr();l!==u;)a.push(l),l=Cr();for((l=tr())!==u?o=l:(Nt=o,o=u),o===u&&(o=null),a=[],l=Cr();l!==u;)a.push(l),l=Cr();93===e.charCodeAt(Nt)?(l=b,Nt++):(l=u,0===Ft&&Bt(be)),l!==u?(Dt=t,t=Sr("attr",{name:s,value:o||Sr("bool",{value:!0})})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;return Ut[i]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f,h,v,d,m,x,g=77*Nt+19,A=Ut[g];if(A)return Nt=A.nextPos,A.result;t=Nt,e.substr(Nt,4)===P?(r=P,Nt+=4):(r=u,0===Ft&&Bt(Pe));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(40===e.charCodeAt(Nt)?(s=c,Nt++):(s=u,0===Ft&&Bt(ae)),s!==u)if(e.substr(Nt,3)===y?(o=y,Nt+=3):(o=u,0===Ft&&Bt(de)),o!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();if((l=gr())!==u){for(i=[],f=Cr();f!==u;)i.push(f),f=Cr();for(44===e.charCodeAt(Nt)?(f=w,Nt++):(f=u,0===Ft&&Bt(we)),f===u&&(f=null),h=[],v=Cr();v!==u;)h.push(v),v=Cr();if((v=Xt())!==u)if(41===e.charCodeAt(Nt)?(d=p,Nt++):(d=u,0===Ft&&Bt(ie)),d!==u){for(m=[],x=Cr();x!==u;)m.push(x),x=Cr();(x=Wt())!==u?(Dt=t,t=xt(l,v,x)):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;if(t===u)if(t=Nt,e.substr(Nt,4)===P?(r=P,Nt+=4):(r=u,0===Ft&&Bt(Pe)),r!==u){if(n=[],(s=Cr())!==u)for(;s!==u;)n.push(s),s=Cr();else n=u;if(n!==u)if(e.substr(Nt,3)===y?(s=y,Nt+=3):(s=u,0===Ft&&Bt(de)),s!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();if((a=gr())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();for(44===e.charCodeAt(Nt)?(i=w,Nt++):(i=u,0===Ft&&Bt(we)),i===u&&(i=null),f=[],h=Cr();h!==u;)f.push(h),h=Cr();if((h=Xt())!==u){if(v=[],(d=Cr())!==u)for(;d!==u;)v.push(d),d=Cr();else v=u;v!==u&&(d=Wt())!==u?(Dt=t,t=xt(a,h,d)):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;return Ut[g]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f,h,v,d,m,g,A,b=77*Nt+20,P=Ut[b];if(P)return Nt=P.nextPos,P.result;t=Nt,e.substr(Nt,3)===C?(r=C,Nt+=3):(r=u,0===Ft&&Bt(Ce));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(40===e.charCodeAt(Nt)?(s=c,Nt++):(s=u,0===Ft&&Bt(ae)),s!==u)if(e.substr(Nt,3)===y?(o=y,Nt+=3):(o=u,0===Ft&&Bt(de)),o!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();if((l=gr())!==u){for(i=[],f=Cr();f!==u;)i.push(f),f=Cr();if(f=Nt,61===e.charCodeAt(Nt)?(h=x,Nt++):(h=u,0===Ft&&Bt(me)),h!==u){for(v=[],d=Cr();d!==u;)v.push(d),d=Cr();(d=Xt())!==u?(Dt=f,f=gt(0,d)):(Nt=f,f=u)}else Nt=f,f=u;for(f===u&&(f=null),44===e.charCodeAt(Nt)?(h=w,Nt++):(h=u,0===Ft&&Bt(we)),h===u&&(h=null),v=[],d=Cr();d!==u;)v.push(d),d=Cr();if((d=Xt())!==u)if(41===e.charCodeAt(Nt)?(m=p,Nt++):(m=u,0===Ft&&Bt(ie)),m!==u){for(g=[],A=Cr();A!==u;)g.push(A),A=Cr();(A=Wt())!==u?(Dt=t,t=At(l,f,d,A)):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;if(t===u){if(t=Nt,e.substr(Nt,3)===C?(r=C,Nt+=3):(r=u,0===Ft&&Bt(Ce)),r!==u){if(n=[],(s=Cr())!==u)for(;s!==u;)n.push(s),s=Cr();else n=u;if(n!==u)if(e.substr(Nt,3)===y?(s=y,Nt+=3):(s=u,0===Ft&&Bt(de)),s!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();if((a=gr())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();if(i=Nt,61===e.charCodeAt(Nt)?(f=x,Nt++):(f=u,0===Ft&&Bt(me)),f!==u){for(h=[],v=Cr();v!==u;)h.push(v),v=Cr();(v=Xt())!==u?(Dt=i,i=gt(0,v)):(Nt=i,i=u)}else Nt=i,i=u;for(i===u&&(i=null),44===e.charCodeAt(Nt)?(f=w,Nt++):(f=u,0===Ft&&Bt(we)),f===u&&(f=null),h=[],v=Cr();v!==u;)h.push(v),v=Cr();if((v=Xt())!==u){if(d=[],(m=Cr())!==u)for(;m!==u;)d.push(m),m=Cr();else d=u;d!==u&&(m=Wt())!==u?(Dt=t,t=At(a,i,v,m)):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;if(t===u){if(t=Nt,e.substr(Nt,3)===C?(r=C,Nt+=3):(r=u,0===Ft&&Bt(Ce)),r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(40===e.charCodeAt(Nt)?(s=c,Nt++):(s=u,0===Ft&&Bt(ae)),s!==u)if((o=Xt())!==u)if(41===e.charCodeAt(Nt)?(a=p,Nt++):(a=u,0===Ft&&Bt(ie)),a!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();(i=Wt())!==u?(Dt=t,t=bt(o,i)):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;if(t===u)if(t=Nt,e.substr(Nt,3)===C?(r=C,Nt+=3):(r=u,0===Ft&&Bt(Ce)),r!==u){if(n=[],(s=Cr())!==u)for(;s!==u;)n.push(s),s=Cr();else n=u;if(n!==u)if((s=Xt())!==u){if(o=[],(a=Cr())!==u)for(;a!==u;)o.push(a),a=Cr();else o=u;o!==u&&(a=Wt())!==u?(Dt=t,t=bt(s,a)):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u}}return Ut[b]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f=77*Nt+22,c=Ut[f];if(c)return Nt=c.nextPos,c.result;t=Nt,e.substr(Nt,4)===_?(r=_,Nt+=4):(r=u,0===Ft&&Bt(_e));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(123===e.charCodeAt(Nt)?(s=h,Nt++):(s=u,0===Ft&&Bt(pe)),s!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();if((a=Gt())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();125===e.charCodeAt(Nt)?(i=v,Nt++):(i=u,0===Ft&&Bt(he)),i!==u?(Dt=t,t=Sr("loop",{statements:a})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;return Ut[f]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o=77*Nt+23,a=Ut[o];if(a)return Nt=a.nextPos,a.result;t=Nt,e.substr(Nt,5)===S?(r=S,Nt+=5):(r=u,0===Ft&&Bt(Se));r!==u?(n=Nt,Ft++,G.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(je)),Ft--,s===u?n=void 0:(Nt=n,n=u),n!==u?(Dt=t,t=Sr("break",{})):(Nt=t,t=u)):(Nt=t,t=u);return Ut[o]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o=77*Nt+24,a=Ut[o];if(a)return Nt=a.nextPos,a.result;t=Nt,e.substr(Nt,8)===j?(r=j,Nt+=8):(r=u,0===Ft&&Bt(Me));r!==u?(n=Nt,Ft++,G.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(je)),Ft--,s===u?n=void 0:(Nt=n,n=u),n!==u?(Dt=t,t=Sr("continue",{})):(Nt=t,t=u)):(Nt=t,t=u);return Ut[o]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l=77*Nt+25,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if(t=Nt,(r=Ar())!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(61===e.charCodeAt(Nt)?(s=x,Nt++):(s=u,0===Ft&&Bt(me)),s!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();(a=Xt())!==u?(Dt=t,t=Sr("assign",{name:r,expr:a})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i=77*Nt+26,f=Ut[i];if(f)return Nt=f.nextPos,f.result;if(t=Nt,(r=Ar())!==u){if(n=[],s=Nt,46===e.charCodeAt(Nt)?(o=M,Nt++):(o=u,0===Ft&&Bt(Oe)),o!==u&&(a=gr())!==u?(Dt=s,s=Pt(0,a)):(Nt=s,s=u),s!==u)for(;s!==u;)n.push(s),s=Nt,46===e.charCodeAt(Nt)?(o=M,Nt++):(o=u,0===Ft&&Bt(Oe)),o!==u&&(a=gr())!==u?(Dt=s,s=Pt(0,a)):(Nt=s,s=u);else n=u;if(n!==u){for(s=[],o=Cr();o!==u;)s.push(o),o=Cr();if(61===e.charCodeAt(Nt)?(o=x,Nt++):(o=u,0===Ft&&Bt(me)),o!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();(l=Xt())!==u?(Dt=t,t=Sr("propAssign",{obj:r,path:n,expr:l})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;return Ut[i]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f,c,p,h=77*Nt+27,v=Ut[h];if(v)return Nt=v.nextPos,v.result;if(t=Nt,(r=Ar())!==u)if(91===e.charCodeAt(Nt)?(n=O,Nt++):(n=u,0===Ft&&Bt($e)),n!==u){for(s=[],o=Cr();o!==u;)s.push(o),o=Cr();if((o=Xt())!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();if(93===e.charCodeAt(Nt)?(l=b,Nt++):(l=u,0===Ft&&Bt(be)),l!==u){for(i=[],f=Cr();f!==u;)i.push(f),f=Cr();if(61===e.charCodeAt(Nt)?(f=x,Nt++):(f=u,0===Ft&&Bt(me)),f!==u){for(c=[],p=Cr();p!==u;)c.push(p),p=Cr();(p=Xt())!==u?(Dt=t,t=Sr("indexAssign",{arr:r,i:o,expr:p})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;else Nt=t,t=u;return Ut[h]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l=77*Nt+28,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if(t=Nt,(r=Ar())!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(e.substr(Nt,2)===$?(s=$,Nt+=2):(s=u,0===Ft&&Bt(Ee)),s!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();(a=Xt())!==u?(Dt=t,t=Sr("inc",{name:r,expr:a})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l=77*Nt+29,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if(t=Nt,(r=Ar())!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(e.substr(Nt,2)===E?(s=E,Nt+=2):(s=u,0===Ft&&Bt(Ne)),s!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();(a=Xt())!==u?(Dt=t,t=Sr("dec",{name:r,expr:a})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}())===u&&(t=Xt()),Ut[r]={nextPos:Nt,result:t},t)}function Xt(){var e,t=77*Nt+10,r=Ut[t];return r?(Nt=r.nextPos,r.result):((e=function(){var e,t,r,n,s,o,a,l,i=77*Nt+30,f=Ut[i];if(f)return Nt=f.nextPos,f.result;if(e=Nt,(t=er())!==u){for(r=[],n=Nt,s=[],o=sr();o!==u;)s.push(o),o=sr();if((o=or())!==u){for(a=[],l=sr();l!==u;)a.push(l),l=sr();(l=er())!==u?(Dt=n,n=wt(0,o,l)):(Nt=n,n=u)}else Nt=n,n=u;if(n!==u)for(;n!==u;){for(r.push(n),n=Nt,s=[],o=sr();o!==u;)s.push(o),o=sr();if((o=or())!==u){for(a=[],l=sr();l!==u;)a.push(l),l=sr();(l=er())!==u?(Dt=n,n=wt(0,o,l)):(Nt=n,n=u)}else Nt=n,n=u}else r=u;r!==u?(Dt=e,e=Sr("infix",{operands:[t,...(c=r).map((e=>e.t))],operators:c.map((e=>e.o))})):(Nt=e,e=u)}else Nt=e,e=u;var c;return Ut[i]={nextPos:Nt,result:e},e}())===u&&(e=er()),Ut[t]={nextPos:Nt,result:e},e)}function er(){var t,r,n,s,o,a,l=77*Nt+11,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if((t=function(){var t,r,n,s,o,a,l,i,f,c,p=77*Nt+34,h=Ut[p];if(h)return Nt=h.nextPos,h.result;t=Nt,e.substr(Nt,2)===D?(r=D,Nt+=2):(r=u,0===Ft&&Bt(Fe));if(r!==u){if(n=[],(s=Cr())!==u)for(;s!==u;)n.push(s),s=Cr();else n=u;if(n!==u)if((s=Xt())!==u){if(o=[],(a=Cr())!==u)for(;a!==u;)o.push(a),a=Cr();else o=u;if(o!==u)if((a=Wt())!==u){if(l=Nt,i=[],(f=Cr())!==u)for(;f!==u;)i.push(f),f=Cr();else i=u;if(i!==u&&(f=function(){var e,t,r,n,s,o,a=77*Nt+35,l=Ut[a];if(l)return Nt=l.nextPos,l.result;if(e=Nt,(t=ur())!==u){for(r=[],n=Nt,s=[],o=Cr();o!==u;)s.push(o),o=Cr();for((o=ur())!==u?n=o:(Nt=n,n=u);n!==u;){for(r.push(n),n=Nt,s=[],o=Cr();o!==u;)s.push(o),o=Cr();(o=ur())!==u?n=o:(Nt=n,n=u)}Dt=e,e=mt(t,r)}else Nt=e,e=u;return Ut[a]={nextPos:Nt,result:e},e}())!==u?l=f:(Nt=l,l=u),l===u&&(l=null),i=Nt,f=[],(c=Cr())!==u)for(;c!==u;)f.push(c),c=Cr();else f=u;f!==u&&(c=function(){var t,r,n,s,o=77*Nt+37,a=Ut[o];if(a)return Nt=a.nextPos,a.result;t=Nt,e.substr(Nt,4)===I?(r=I,Nt+=4):(r=u,0===Ft&&Bt(ze));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();(s=Wt())!==u?(Dt=t,t=s):(Nt=t,t=u)}else Nt=t,t=u;return Ut[o]={nextPos:Nt,result:t},t}())!==u?i=c:(Nt=i,i=u),i===u&&(i=null),Dt=t,t=Sr("if",{cond:s,then:a,elseif:l||[],else:i})}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;return Ut[p]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f,h,v,d=77*Nt+63,y=Ut[d];if(y)return Nt=y.nextPos,y.result;t=Nt,40===e.charCodeAt(Nt)?(r=c,Nt++):(r=u,0===Ft&&Bt(ae));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();for((s=yr())===u&&(s=null),o=[],a=Cr();a!==u;)o.push(a),a=Cr();if(41===e.charCodeAt(Nt)?(a=p,Nt++):(a=u,0===Ft&&Bt(ie)),a!==u){for(l=Nt,i=[],f=Cr();f!==u;)i.push(f),f=Cr();if(e.substr(Nt,2)===L?(f=L,Nt+=2):(f=u,0===Ft&&Bt(nt)),f!==u){for(h=[],v=Cr();v!==u;)h.push(v),v=Cr();(v=xr())!==u?l=v:(Nt=l,l=u)}else Nt=l,l=u;if(l===u&&(l=null),i=[],(f=Cr())!==u)for(;f!==u;)i.push(f),f=Cr();else i=u;if(i!==u)if(e.substr(Nt,2)===N?(f=N,Nt+=2):(f=u,0===Ft&&Bt(Ie)),f!==u){if(h=[],(v=Cr())!==u)for(;v!==u;)h.push(v),v=Cr();else h=u;h!==u&&(v=Xt())!==u?(Dt=t,t=Sr("fn",{args:s||[],ret:l},[v])):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;return Ut[d]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f,c,p,d,y,m,x,g,A=77*Nt+38,b=Ut[A];if(b)return Nt=b.nextPos,b.result;t=Nt,e.substr(Nt,5)===q?(r=q,Nt+=5):(r=u,0===Ft&&Bt(Te));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if((s=Xt())!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();if(123===e.charCodeAt(Nt)?(a=h,Nt++):(a=u,0===Ft&&Bt(pe)),a!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();if(i=[],f=Nt,(c=Xt())!==u){for(p=[],d=Cr();d!==u;)p.push(d),d=Cr();if(e.substr(Nt,2)===N?(d=N,Nt+=2):(d=u,0===Ft&&Bt(Ie)),d!==u){for(y=[],m=Cr();m!==u;)y.push(m),m=Cr();if((m=Xt())!==u){for(x=[],g=Cr();g!==u;)x.push(g),g=Cr();Dt=f,f=Ct(0,c,m)}else Nt=f,f=u}else Nt=f,f=u}else Nt=f,f=u;if(f!==u)for(;f!==u;)if(i.push(f),f=Nt,(c=Xt())!==u){for(p=[],d=Cr();d!==u;)p.push(d),d=Cr();if(e.substr(Nt,2)===N?(d=N,Nt+=2):(d=u,0===Ft&&Bt(Ie)),d!==u){for(y=[],m=Cr();m!==u;)y.push(m),m=Cr();if((m=Xt())!==u){for(x=[],g=Cr();g!==u;)x.push(g),g=Cr();Dt=f,f=Ct(0,c,m)}else Nt=f,f=u}else Nt=f,f=u}else Nt=f,f=u;else i=u;if(i!==u){if(f=Nt,42===e.charCodeAt(Nt)?(c="*",Nt++):(c=u,0===Ft&&Bt(Re)),c!==u){for(p=[],d=Cr();d!==u;)p.push(d),d=Cr();if(e.substr(Nt,2)===N?(d=N,Nt+=2):(d=u,0===Ft&&Bt(Ie)),d!==u){for(y=[],m=Cr();m!==u;)y.push(m),m=Cr();if((m=Xt())!==u){for(x=[],g=Cr();g!==u;)x.push(g),g=Cr();Dt=f,f=m}else Nt=f,f=u}else Nt=f,f=u}else Nt=f,f=u;for(f===u&&(f=null),c=[],p=Cr();p!==u;)c.push(p),p=Cr();125===e.charCodeAt(Nt)?(p=v,Nt++):(p=u,0===Ft&&Bt(he)),p!==u?(Dt=t,t=Sr("match",{about:s,qs:i||[],default:f})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;return Ut[A]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l=77*Nt+39,i=Ut[l];if(i)return Nt=i.nextPos,i.result;t=Nt,123===e.charCodeAt(Nt)?(r=h,Nt++):(r=u,0===Ft&&Bt(pe));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if((s=Gt())!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();125===e.charCodeAt(Nt)?(a=v,Nt++):(a=u,0===Ft&&Bt(he)),a!==u?(Dt=t,t=Sr("block",{statements:s})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r=77*Nt+12,n=Ut[r];if(n)return Nt=n.nextPos,n.result;(t=lr())===u&&(t=fr())===u&&(t=pr())===u&&(t=hr())===u&&(t=vr())===u&&(t=function(){var t,r,n,s,o,a,l,i,f,c,p,d,y,x,g=77*Nt+58,A=Ut[g];if(A)return Nt=A.nextPos,A.result;t=Nt,123===e.charCodeAt(Nt)?(r=h,Nt++):(r=u,0===Ft&&Bt(pe));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(s=[],o=Nt,(a=gr())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();if(58===e.charCodeAt(Nt)?(i=m,Nt++):(i=u,0===Ft&&Bt(ye)),i!==u){if(f=[],(c=Cr())!==u)for(;c!==u;)f.push(c),c=Cr();else f=u;if(f!==u)if((c=Xt())!==u){for(p=[],d=Cr();d!==u;)p.push(d),d=Cr();for(44===e.charCodeAt(Nt)?(d=w,Nt++):(d=u,0===Ft&&Bt(we)),d===u&&(59===e.charCodeAt(Nt)?(d=V,Nt++):(d=u,0===Ft&&Bt(tt))),d===u&&(d=null),y=[],x=Cr();x!==u;)y.push(x),x=Cr();Dt=o,o=Mt(a,c)}else Nt=o,o=u;else Nt=o,o=u}else Nt=o,o=u}else Nt=o,o=u;for(;o!==u;)if(s.push(o),o=Nt,(a=gr())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();if(58===e.charCodeAt(Nt)?(i=m,Nt++):(i=u,0===Ft&&Bt(ye)),i!==u){if(f=[],(c=Cr())!==u)for(;c!==u;)f.push(c),c=Cr();else f=u;if(f!==u)if((c=Xt())!==u){for(p=[],d=Cr();d!==u;)p.push(d),d=Cr();for(44===e.charCodeAt(Nt)?(d=w,Nt++):(d=u,0===Ft&&Bt(we)),d===u&&(59===e.charCodeAt(Nt)?(d=V,Nt++):(d=u,0===Ft&&Bt(tt))),d===u&&(d=null),y=[],x=Cr();x!==u;)y.push(x),x=Cr();Dt=o,o=Mt(a,c)}else Nt=o,o=u;else Nt=o,o=u}else Nt=o,o=u}else Nt=o,o=u;125===e.charCodeAt(Nt)?(o=v,Nt++):(o=u,0===Ft&&Bt(he)),o!==u?(Dt=t,t=Ot(s)):(Nt=t,t=u)}else Nt=t,t=u;return Ut[g]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f,c,p=77*Nt+59,h=Ut[p];if(h)return Nt=h.nextPos,h.result;t=Nt,91===e.charCodeAt(Nt)?(r=O,Nt++):(r=u,0===Ft&&Bt($e));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(s=[],o=Nt,(a=Xt())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();for(44===e.charCodeAt(Nt)?(i=w,Nt++):(i=u,0===Ft&&Bt(we)),i===u&&(i=null),f=[],c=Cr();c!==u;)f.push(c),c=Cr();Dt=o,o=a}else Nt=o,o=u;for(;o!==u;)if(s.push(o),o=Nt,(a=Xt())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();for(44===e.charCodeAt(Nt)?(i=w,Nt++):(i=u,0===Ft&&Bt(we)),i===u&&(i=null),f=[],c=Cr();c!==u;)f.push(c),c=Cr();Dt=o,o=a}else Nt=o,o=u;for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();93===e.charCodeAt(Nt)?(a=b,Nt++):(a=u,0===Ft&&Bt(be)),a!==u?(Dt=t,t=$t(s)):(Nt=t,t=u)}else Nt=t,t=u;return Ut[p]={nextPos:Nt,result:t},t}());return Ut[r]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i=77*Nt+40,f=Ut[i];if(f)return Nt=f.nextPos,f.result;if(t=Nt,(r=Ar())!==u)if(40===e.charCodeAt(Nt)?(n=c,Nt++):(n=u,0===Ft&&Bt(ae)),n!==u){for(s=[],o=Cr();o!==u;)s.push(o),o=Cr();for((o=ar())===u&&(o=null),a=[],l=Cr();l!==u;)a.push(l),l=Cr();41===e.charCodeAt(Nt)?(l=p,Nt++):(l=u,0===Ft&&Bt(ie)),l!==u?(Dt=t,t=Sr("call",{name:r,args:o||[]})):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u;return Ut[i]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i=77*Nt+42,f=Ut[i];if(f)return Nt=f.nextPos,f.result;if(t=Nt,(r=Ar())!==u)if(91===e.charCodeAt(Nt)?(n=O,Nt++):(n=u,0===Ft&&Bt($e)),n!==u){for(s=[],o=Cr();o!==u;)s.push(o),o=Cr();if((o=Xt())!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();93===e.charCodeAt(Nt)?(l=b,Nt++):(l=u,0===Ft&&Bt(be)),l!==u?(Dt=t,t=Sr("index",{arr:r,i:o})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;else Nt=t,t=u;return Ut[i]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f=77*Nt+43,h=Ut[f];if(h)return Nt=h.nextPos,h.result;if(t=Nt,(r=Ar())!==u){if(n=[],s=Nt,46===e.charCodeAt(Nt)?(o=M,Nt++):(o=u,0===Ft&&Bt(Oe)),o!==u&&(a=gr())!==u?(Dt=s,s=Pt(0,a)):(Nt=s,s=u),s!==u)for(;s!==u;)n.push(s),s=Nt,46===e.charCodeAt(Nt)?(o=M,Nt++):(o=u,0===Ft&&Bt(Oe)),o!==u&&(a=gr())!==u?(Dt=s,s=Pt(0,a)):(Nt=s,s=u);else n=u;if(n!==u)if(40===e.charCodeAt(Nt)?(s=c,Nt++):(s=u,0===Ft&&Bt(ae)),s!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();for((a=ar())===u&&(a=null),l=[],i=Cr();i!==u;)l.push(i),i=Cr();41===e.charCodeAt(Nt)?(i=p,Nt++):(i=u,0===Ft&&Bt(ie)),i!==u?(Dt=t,t=Sr("propCall",{obj:r,path:n,args:a||[]})):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;return Ut[f]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l=77*Nt+44,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if(t=Nt,(r=Ar())!==u){if(n=[],s=Nt,46===e.charCodeAt(Nt)?(o=M,Nt++):(o=u,0===Ft&&Bt(Oe)),o!==u&&(a=gr())!==u?(Dt=s,s=Pt(0,a)):(Nt=s,s=u),s!==u)for(;s!==u;)n.push(s),s=Nt,46===e.charCodeAt(Nt)?(o=M,Nt++):(o=u,0===Ft&&Bt(Oe)),o!==u&&(a=gr())!==u?(Dt=s,s=Pt(0,a)):(Nt=s,s=u);else n=u;n!==u?(Dt=t,t=Sr("prop",{obj:r,path:n})):(Nt=t,t=u)}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}())===u&&(t=function(){var e,t,r=77*Nt+45,n=Ut[r];if(n)return Nt=n.nextPos,n.result;e=Nt,(t=Ar())!==u&&(Dt=e,t=Sr("var",{name:t}));return e=t,Ut[r]={nextPos:Nt,result:e},e}())===u)if(t=Nt,40===e.charCodeAt(Nt)?(r=c,Nt++):(r=u,0===Ft&&Bt(ae)),r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if((s=Xt())!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();41===e.charCodeAt(Nt)?(a=p,Nt++):(a=u,0===Ft&&Bt(ie)),a!==u?(Dt=t,t=s):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}function tr(){var t,r=77*Nt+13,n=Ut[r];return n?(Nt=n.nextPos,n.result):((t=pr())===u&&(t=fr())===u&&(t=hr())===u&&(t=function(){var t,r,n,s,o,a,l,i,f,c,p=77*Nt+64,h=Ut[p];if(h)return Nt=h.nextPos,h.result;t=Nt,91===e.charCodeAt(Nt)?(r=O,Nt++):(r=u,0===Ft&&Bt($e));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(s=[],o=Nt,(a=tr())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();for(44===e.charCodeAt(Nt)?(i=w,Nt++):(i=u,0===Ft&&Bt(we)),i===u&&(i=null),f=[],c=Cr();c!==u;)f.push(c),c=Cr();Dt=o,o=a}else Nt=o,o=u;for(;o!==u;)if(s.push(o),o=Nt,(a=tr())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();for(44===e.charCodeAt(Nt)?(i=w,Nt++):(i=u,0===Ft&&Bt(we)),i===u&&(i=null),f=[],c=Cr();c!==u;)f.push(c),c=Cr();Dt=o,o=a}else Nt=o,o=u;for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();93===e.charCodeAt(Nt)?(a=b,Nt++):(a=u,0===Ft&&Bt(be)),a!==u?(Dt=t,t=$t(s)):(Nt=t,t=u)}else Nt=t,t=u;return Ut[p]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f,c,p,d,y,x,g=77*Nt+65,A=Ut[g];if(A)return Nt=A.nextPos,A.result;t=Nt,123===e.charCodeAt(Nt)?(r=h,Nt++):(r=u,0===Ft&&Bt(pe));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if(s=[],o=Nt,(a=gr())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();if(58===e.charCodeAt(Nt)?(i=m,Nt++):(i=u,0===Ft&&Bt(ye)),i!==u){if(f=[],(c=Cr())!==u)for(;c!==u;)f.push(c),c=Cr();else f=u;if(f!==u)if((c=tr())!==u){for(p=[],d=Cr();d!==u;)p.push(d),d=Cr();for(44===e.charCodeAt(Nt)?(d=w,Nt++):(d=u,0===Ft&&Bt(we)),d===u&&(59===e.charCodeAt(Nt)?(d=V,Nt++):(d=u,0===Ft&&Bt(tt))),d===u&&(d=null),y=[],x=Cr();x!==u;)y.push(x),x=Cr();Dt=o,o=Mt(a,c)}else Nt=o,o=u;else Nt=o,o=u}else Nt=o,o=u}else Nt=o,o=u;for(;o!==u;)if(s.push(o),o=Nt,(a=gr())!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();if(58===e.charCodeAt(Nt)?(i=m,Nt++):(i=u,0===Ft&&Bt(ye)),i!==u){if(f=[],(c=Cr())!==u)for(;c!==u;)f.push(c),c=Cr();else f=u;if(f!==u)if((c=tr())!==u){for(p=[],d=Cr();d!==u;)p.push(d),d=Cr();for(44===e.charCodeAt(Nt)?(d=w,Nt++):(d=u,0===Ft&&Bt(we)),d===u&&(59===e.charCodeAt(Nt)?(d=V,Nt++):(d=u,0===Ft&&Bt(tt))),d===u&&(d=null),y=[],x=Cr();x!==u;)y.push(x),x=Cr();Dt=o,o=Mt(a,c)}else Nt=o,o=u;else Nt=o,o=u}else Nt=o,o=u}else Nt=o,o=u;125===e.charCodeAt(Nt)?(o=v,Nt++):(o=u,0===Ft&&Bt(he)),o!==u?(Dt=t,t=Ot(s)):(Nt=t,t=u)}else Nt=t,t=u;return Ut[g]={nextPos:Nt,result:t},t}())===u&&(t=vr()),Ut[r]={nextPos:Nt,result:t},t)}function rr(){var t,r,n,s,o,a,l,i,f,c,p=77*Nt+14,d=Ut[p];if(d)return Nt=d.nextPos,d.result;if(t=Nt,"::"===e.substr(Nt,2)?(r="::",Nt+=2):(r=u,0===Ft&&Bt(ce)),r!==u){if(n=[],(s=Cr())!==u)for(;s!==u;)n.push(s),s=Cr();else n=u;if(n!==u)if((s=gr())!==u){if(o=[],(a=Cr())!==u)for(;a!==u;)o.push(a),a=Cr();else o=u;if(o!==u)if(123===e.charCodeAt(Nt)?(a=h,Nt++):(a=u,0===Ft&&Bt(pe)),a!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();for((i=function(){var e,t,r,n,s,o,a,l,i=77*Nt+5,f=Ut[i];if(f)return Nt=f.nextPos,f.result;if(e=Nt,(t=Qt())!==u){for(r=[],n=Nt,s=[],o=kr();o!==u;)s.push(o),o=kr();if((o=Pr())!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();(l=Qt())!==u?(Dt=n,n=yt(0,l)):(Nt=n,n=u)}else Nt=n,n=u;for(;n!==u;){for(r.push(n),n=Nt,s=[],o=kr();o!==u;)s.push(o),o=kr();if((o=Pr())!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();(l=Qt())!==u?(Dt=n,n=yt(0,l)):(Nt=n,n=u)}else Nt=n,n=u}Dt=e,e=mt(t,r)}else Nt=e,e=u;return Ut[i]={nextPos:Nt,result:e},e}())===u&&(i=null),f=[],c=Cr();c!==u;)f.push(c),c=Cr();125===e.charCodeAt(Nt)?(c=v,Nt++):(c=u,0===Ft&&Bt(he)),c!==u?(Dt=t,t=Sr("ns",{name:s,members:i})):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;return Ut[p]={nextPos:Nt,result:t},t}function nr(){var t,r,n,s,o,a,l,i,f,c=77*Nt+16,p=Ut[c];if(p)return Nt=p.nextPos,p.result;if(t=Nt,e.substr(Nt,3)===y?(r=y,Nt+=3):(r=u,0===Ft&&Bt(de)),r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if((s=gr())!==u){for(o=Nt,a=[],l=Cr();l!==u;)a.push(l),l=Cr();if(58===e.charCodeAt(Nt)?(l=m,Nt++):(l=u,0===Ft&&Bt(ye)),l!==u){for(i=[],f=Cr();f!==u;)i.push(f),f=Cr();(f=xr())!==u?o=f:(Nt=o,o=u)}else Nt=o,o=u;for(o===u&&(o=null),a=[],l=Cr();l!==u;)a.push(l),l=Cr();if(61===e.charCodeAt(Nt)?(l=x,Nt++):(l=u,0===Ft&&Bt(me)),l!==u){for(i=[],f=Cr();f!==u;)i.push(f),f=Cr();(f=Xt())!==u?(Dt=t,t=Sr("def",{name:s,varType:o,expr:f,mut:!1,attr:[]})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;if(t===u)if(t=Nt,"var"===e.substr(Nt,3)?(r="var",Nt+=3):(r=u,0===Ft&&Bt(xe)),r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if((s=gr())!==u){for(o=Nt,a=[],l=Cr();l!==u;)a.push(l),l=Cr();if(58===e.charCodeAt(Nt)?(l=m,Nt++):(l=u,0===Ft&&Bt(ye)),l!==u){for(i=[],f=Cr();f!==u;)i.push(f),f=Cr();(f=xr())!==u?o=f:(Nt=o,o=u)}else Nt=o,o=u;for(o===u&&(o=null),a=[],l=Cr();l!==u;)a.push(l),l=Cr();if(61===e.charCodeAt(Nt)?(l=x,Nt++):(l=u,0===Ft&&Bt(me)),l!==u){for(i=[],f=Cr();f!==u;)i.push(f),f=Cr();(f=Xt())!==u?(Dt=t,t=function(e,t,r){return Sr("def",{name:e,varType:t,expr:r,mut:!0,attr:[]})}(s,o,f)):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;return Ut[c]={nextPos:Nt,result:t},t}function sr(){var t,r,n,s=77*Nt+31,o=Ut[s];return o?(Nt=o.nextPos,o.result):(t=Nt,92===e.charCodeAt(Nt)?(r="\\",Nt++):(r=u,0===Ft&&Bt(De)),r!==u&&(n=Pr())!==u?t=r=[r,n]:(Nt=t,t=u),t===u&&(t=kr()),Ut[s]={nextPos:Nt,result:t},t)}function or(){var t,r,n,s,o,a,l=77*Nt+33,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if(t=Nt,r=Nt,Ft++,n=Nt,(s=function(){var t,r=77*Nt+32,n=Ut[r];return n?(Nt=n.nextPos,n.result):("<<<"===e.substr(Nt,3)?(t="<<<",Nt+=3):(t=u,0===Ft&&Bt(He)),t===u&&(e.substr(Nt,2)===N?(t=N,Nt+=2):(t=u,0===Ft&&Bt(Ie)),t===u&&(61===e.charCodeAt(Nt)?(t=x,Nt++):(t=u,0===Ft&&Bt(me)),t===u&&(e.substr(Nt,2)===$?(t=$,Nt+=2):(t=u,0===Ft&&Bt(Ee)),t===u&&(e.substr(Nt,2)===E?(t=E,Nt+=2):(t=u,0===Ft&&Bt(Ne)))))),Ut[r]={nextPos:Nt,result:t},t)}())!==u?(o=Nt,Ft++,K.test(e.charAt(Nt))?(a=e.charAt(Nt),Nt++):(a=u,0===Ft&&Bt(qe)),Ft--,a===u?o=void 0:(Nt=o,o=u),o!==u?n=s=[s,o]:(Nt=n,n=u)):(Nt=n,n=u),Ft--,n===u?r=void 0:(Nt=r,r=u),r!==u){if(n=[],K.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(qe)),s!==u)for(;s!==u;)n.push(s),K.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(qe));else n=u;n!==u?(Dt=t,t=vt()):(Nt=t,t=u)}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}function ur(){var t,r,n,s,o,a,l=77*Nt+36,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if(t=Nt,e.substr(Nt,4)===H?(r=H,Nt+=4):(r=u,0===Ft&&Bt(Ue)),r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();if((s=Xt())!==u){for(o=[],a=Cr();a!==u;)o.push(a),a=Cr();(a=Wt())!==u?(Dt=t,t={cond:s,then:a}):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}function ar(){var e,t,r,n,s,o=77*Nt+41,a=Ut[o];if(a)return Nt=a.nextPos,a.result;if(e=Nt,(t=Xt())!==u){for(r=[],n=Nt,br()!==u&&(s=Xt())!==u?(Dt=n,n=kt(0,s)):(Nt=n,n=u);n!==u;)r.push(n),n=Nt,br()!==u&&(s=Xt())!==u?(Dt=n,n=kt(0,s)):(Nt=n,n=u);Dt=e,e=mt(t,r)}else Nt=e,e=u;return Ut[o]={nextPos:Nt,result:e},e}function lr(){var t,r,n,s,o,a,l=77*Nt+46,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if(t=Nt,96===e.charCodeAt(Nt)?(r=F,Nt++):(r=u,0===Ft&&Bt(Je)),r!==u){for(n=[],s=Nt,o=Nt,Ft++,96===e.charCodeAt(Nt)?(a=F,Nt++):(a=u,0===Ft&&Bt(Je)),Ft--,a===u?o=void 0:(Nt=o,o=u),o!==u&&(a=ir())!==u?(Dt=s,s=a):(Nt=s,s=u);s!==u;)n.push(s),s=Nt,o=Nt,Ft++,96===e.charCodeAt(Nt)?(a=F,Nt++):(a=u,0===Ft&&Bt(Je)),Ft--,a===u?o=void 0:(Nt=o,o=u),o!==u&&(a=ir())!==u?(Dt=s,s=a):(Nt=s,s=u);96===e.charCodeAt(Nt)?(s=F,Nt++):(s=u,0===Ft&&Bt(Je)),s!==u?(Dt=t,t=Sr("tmpl",{tmpl:_r(n)})):(Nt=t,t=u)}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}function ir(){var t,r,n,s,o,a,l=77*Nt+47,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if((t=function(){var t,r,n=77*Nt+48,s=Ut[n];if(s)return Nt=s.nextPos,s.result;t=Nt,e.substr(Nt,2)===U?(r=U,Nt+=2):(r=u,0===Ft&&Bt(Ze));r!==u&&(Dt=t,r=_t());(t=r)===u&&(t=Nt,e.substr(Nt,2)===z?(r=z,Nt+=2):(r=u,0===Ft&&Bt(Be)),r!==u&&(Dt=t,r=_t()),(t=r)===u&&(t=Nt,e.substr(Nt,2)===T?(r=T,Nt+=2):(r=u,0===Ft&&Bt(Ve)),r!==u&&(Dt=t,r="`"),t=r));return Ut[n]={nextPos:Nt,result:t},t}())===u){if(t=Nt,123===e.charCodeAt(Nt)?(r=h,Nt++):(r=u,0===Ft&&Bt(pe)),r!==u){for(n=[],s=kr();s!==u;)n.push(s),s=kr();if((s=Xt())!==u){for(o=[],a=kr();a!==u;)o.push(a),a=kr();125===e.charCodeAt(Nt)?(a=v,Nt++):(a=u,0===Ft&&Bt(he)),a!==u?(Dt=t,t=s):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u;t===u&&(e.length>Nt?(t=e.charAt(Nt),Nt++):(t=u,0===Ft&&Bt(oe)))}return Ut[l]={nextPos:Nt,result:t},t}function fr(){var t,r,n,s,o,a,l=77*Nt+49,i=Ut[l];if(i)return Nt=i.nextPos,i.result;if(t=Nt,34===e.charCodeAt(Nt)?(r=R,Nt++):(r=u,0===Ft&&Bt(Le)),r!==u){for(n=[],s=Nt,o=Nt,Ft++,34===e.charCodeAt(Nt)?(a=R,Nt++):(a=u,0===Ft&&Bt(Le)),Ft--,a===u?o=void 0:(Nt=o,o=u),o!==u?((a=cr())===u&&(e.length>Nt?(a=e.charAt(Nt),Nt++):(a=u,0===Ft&&Bt(oe))),a!==u?(Dt=s,s=a):(Nt=s,s=u)):(Nt=s,s=u);s!==u;)n.push(s),s=Nt,o=Nt,Ft++,34===e.charCodeAt(Nt)?(a=R,Nt++):(a=u,0===Ft&&Bt(Le)),Ft--,a===u?o=void 0:(Nt=o,o=u),o!==u?((a=cr())===u&&(e.length>Nt?(a=e.charAt(Nt),Nt++):(a=u,0===Ft&&Bt(oe))),a!==u?(Dt=s,s=a):(Nt=s,s=u)):(Nt=s,s=u);34===e.charCodeAt(Nt)?(s=R,Nt++):(s=u,0===Ft&&Bt(Le)),s!==u?(Dt=t,t=Sr("str",{value:n.join("")})):(Nt=t,t=u)}else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}function cr(){var t,r,n=77*Nt+50,s=Ut[n];return s?(Nt=s.nextPos,s.result):(t=Nt,'\\"'===e.substr(Nt,2)?(r='\\"',Nt+=2):(r=u,0===Ft&&Bt(Ye)),r!==u&&(Dt=t,r='"'),t=r,Ut[n]={nextPos:Nt,result:t},t)}function pr(){var t,r=77*Nt+51,n=Ut[r];return n?(Nt=n.nextPos,n.result):((t=function(){var t,r,n,s,o,a,l=77*Nt+52,i=Ut[l];if(i)return Nt=i.nextPos,i.result;t=Nt,Q.test(e.charAt(Nt))?(e.charAt(Nt),Nt++):0===Ft&&Bt(Ge);r=[],W.test(e.charAt(Nt))?(n=e.charAt(Nt),Nt++):(n=u,0===Ft&&Bt(Ke));if(n!==u)for(;n!==u;)r.push(n),W.test(e.charAt(Nt))?(n=e.charAt(Nt),Nt++):(n=u,0===Ft&&Bt(Ke));else r=u;if(r!==u){if(n=[],X.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(Qe)),s!==u)for(;s!==u;)n.push(s),X.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(Qe));else n=u;if(n!==u)if(46===e.charCodeAt(Nt)?(s=M,Nt++):(s=u,0===Ft&&Bt(Oe)),s!==u){if(o=[],X.test(e.charAt(Nt))?(a=e.charAt(Nt),Nt++):(a=u,0===Ft&&Bt(Qe)),a!==u)for(;a!==u;)o.push(a),X.test(e.charAt(Nt))?(a=e.charAt(Nt),Nt++):(a=u,0===Ft&&Bt(Qe));else o=u;o!==u?(Dt=t,t=St()):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;if(t===u)if(t=Nt,Q.test(e.charAt(Nt))?(e.charAt(Nt),Nt++):0===Ft&&Bt(Ge),X.test(e.charAt(Nt))?(r=e.charAt(Nt),Nt++):(r=u,0===Ft&&Bt(Qe)),r!==u)if(46===e.charCodeAt(Nt)?(n=M,Nt++):(n=u,0===Ft&&Bt(Oe)),n!==u){if(s=[],X.test(e.charAt(Nt))?(o=e.charAt(Nt),Nt++):(o=u,0===Ft&&Bt(Qe)),o!==u)for(;o!==u;)s.push(o),X.test(e.charAt(Nt))?(o=e.charAt(Nt),Nt++):(o=u,0===Ft&&Bt(Qe));else s=u;s!==u?(Dt=t,t=St()):(Nt=t,t=u)}else Nt=t,t=u;else Nt=t,t=u;return Ut[l]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o=77*Nt+53,a=Ut[o];if(a)return Nt=a.nextPos,a.result;t=Nt,Q.test(e.charAt(Nt))?(e.charAt(Nt),Nt++):0===Ft&&Bt(Ge);W.test(e.charAt(Nt))?(r=e.charAt(Nt),Nt++):(r=u,0===Ft&&Bt(Ke));if(r!==u){if(n=[],X.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(Qe)),s!==u)for(;s!==u;)n.push(s),X.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(Qe));else n=u;n!==u?(Dt=t,t=jt()):(Nt=t,t=u)}else Nt=t,t=u;t===u&&(t=Nt,Q.test(e.charAt(Nt))?(e.charAt(Nt),Nt++):0===Ft&&Bt(Ge),X.test(e.charAt(Nt))?(r=e.charAt(Nt),Nt++):(r=u,0===Ft&&Bt(Qe)),r!==u?(Dt=t,t=jt()):(Nt=t,t=u));return Ut[o]={nextPos:Nt,result:t},t}()),Ut[r]={nextPos:Nt,result:t},t)}function hr(){var t,r=77*Nt+54,n=Ut[r];return n?(Nt=n.nextPos,n.result):((t=function(){var t,r,n,s,o=77*Nt+55,a=Ut[o];if(a)return Nt=a.nextPos,a.result;t=Nt,e.substr(Nt,4)===J?(r=J,Nt+=4):(r=u,0===Ft&&Bt(We));r!==u?(n=Nt,Ft++,G.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(je)),Ft--,s===u?n=void 0:(Nt=n,n=u),n!==u?(Dt=t,t=Sr("bool",{value:!0})):(Nt=t,t=u)):(Nt=t,t=u);return Ut[o]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o=77*Nt+56,a=Ut[o];if(a)return Nt=a.nextPos,a.result;t=Nt,e.substr(Nt,5)===Z?(r=Z,Nt+=5):(r=u,0===Ft&&Bt(Xe));r!==u?(n=Nt,Ft++,G.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(je)),Ft--,s===u?n=void 0:(Nt=n,n=u),n!==u?(Dt=t,t=Sr("bool",{value:!1})):(Nt=t,t=u)):(Nt=t,t=u);return Ut[o]={nextPos:Nt,result:t},t}()),Ut[r]={nextPos:Nt,result:t},t)}function vr(){var t,r,n,s,o=77*Nt+57,a=Ut[o];return a?(Nt=a.nextPos,a.result):(t=Nt,e.substr(Nt,4)===B?(r=B,Nt+=4):(r=u,0===Ft&&Bt(et)),r!==u?(n=Nt,Ft++,G.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(je)),Ft--,s===u?n=void 0:(Nt=n,n=u),n!==u?(Dt=t,t=Sr("null",{})):(Nt=t,t=u)):(Nt=t,t=u),Ut[o]={nextPos:Nt,result:t},t)}function dr(){var t,r,n,s,o,a,l,i=77*Nt+60,f=Ut[i];if(f)return Nt=f.nextPos,f.result;if(t=Nt,(r=gr())!==u){for(n=Nt,s=[],o=Cr();o!==u;)s.push(o),o=Cr();if(58===e.charCodeAt(Nt)?(o=m,Nt++):(o=u,0===Ft&&Bt(ye)),o!==u){for(a=[],l=Cr();l!==u;)a.push(l),l=Cr();(l=xr())!==u?n=l:(Nt=n,n=u)}else Nt=n,n=u;n===u&&(n=null),Dt=t,t={name:r,type:n}}else Nt=t,t=u;return Ut[i]={nextPos:Nt,result:t},t}function yr(){var e,t,r,n,s,o=77*Nt+61,a=Ut[o];if(a)return Nt=a.nextPos,a.result;if(e=Nt,(t=dr())!==u){for(r=[],n=Nt,br()!==u&&(s=dr())!==u?n=s:(Nt=n,n=u);n!==u;)r.push(n),n=Nt,br()!==u&&(s=dr())!==u?n=s:(Nt=n,n=u);Dt=e,e=mt(t,r)}else Nt=e,e=u;return Ut[o]={nextPos:Nt,result:e},e}function mr(){var t,r,n,s,o,a,l,i,f,d,y,m,x,g,A,b,P,w=77*Nt+62,C=Ut[w];if(C)return Nt=C.nextPos,C.result;if(t=Nt,"fn"===e.substr(Nt,2)?(r="fn",Nt+=2):(r=u,0===Ft&&Bt(rt)),r!==u){if(n=[],(s=Cr())!==u)for(;s!==u;)n.push(s),s=Cr();else n=u;if(n!==u)if((s=gr())!==u){for(o=[],a=kr();a!==u;)o.push(a),a=kr();if(40===e.charCodeAt(Nt)?(a=c,Nt++):(a=u,0===Ft&&Bt(ae)),a!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();for((i=yr())===u&&(i=null),f=[],d=Cr();d!==u;)f.push(d),d=Cr();if(41===e.charCodeAt(Nt)?(d=p,Nt++):(d=u,0===Ft&&Bt(ie)),d!==u){for(y=Nt,m=[],x=Cr();x!==u;)m.push(x),x=Cr();if(e.substr(Nt,2)===L?(x=L,Nt+=2):(x=u,0===Ft&&Bt(nt)),x!==u){for(g=[],A=Cr();A!==u;)g.push(A),A=Cr();(A=xr())!==u?y=A:(Nt=y,y=u)}else Nt=y,y=u;for(y===u&&(y=null),m=[],x=Cr();x!==u;)m.push(x),x=Cr();if(123===e.charCodeAt(Nt)?(x=h,Nt++):(x=u,0===Ft&&Bt(pe)),x!==u){for(g=[],A=Cr();A!==u;)g.push(A),A=Cr();for((A=Gt())===u&&(A=null),b=[],P=Cr();P!==u;)b.push(P),P=Cr();125===e.charCodeAt(Nt)?(P=v,Nt++):(P=u,0===Ft&&Bt(he)),P!==u?(Dt=t,t=Et(s,o,i,y,A)):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;else Nt=t,t=u}else Nt=t,t=u;return Ut[w]={nextPos:Nt,result:t},t}function xr(){var t,r=77*Nt+66,n=Ut[r];return n?(Nt=n.nextPos,n.result):((t=function(){var t,r,n,s,o,a,l,i,f,c,p=77*Nt+67,h=Ut[p];if(h)return Nt=h.nextPos,h.result;t=Nt,124===e.charCodeAt(Nt)?(r=Y,Nt++):(r=u,0===Ft&&Bt(st));if(r!==u){for(n=[],s=Cr();s!==u;)n.push(s),s=Cr();for((s=function(){var e,t,r,n,s,o=77*Nt+68,a=Ut[o];if(a)return Nt=a.nextPos,a.result;if(e=Nt,(t=xr())!==u){for(r=[],n=Nt,br()!==u&&(s=xr())!==u?n=s:(Nt=n,n=u);n!==u;)r.push(n),n=Nt,br()!==u&&(s=xr())!==u?n=s:(Nt=n,n=u);Dt=e,e=mt(t,r)}else Nt=e,e=u;return Ut[o]={nextPos:Nt,result:e},e}())===u&&(s=null),o=[],a=Cr();a!==u;)o.push(a),a=Cr();if(124===e.charCodeAt(Nt)?(a=Y,Nt++):(a=u,0===Ft&&Bt(st)),a!==u){for(l=[],i=Cr();i!==u;)l.push(i),i=Cr();if(e.substr(Nt,2)===L?(i=L,Nt+=2):(i=u,0===Ft&&Bt(nt)),i!==u){for(f=[],c=Cr();c!==u;)f.push(c),c=Cr();(c=xr())!==u?(Dt=t,t=Sr("fn",{args:s||[],result:c})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;return Ut[p]={nextPos:Nt,result:t},t}())===u&&(t=function(){var t,r,n,s,o,a,l,i,f=77*Nt+69,c=Ut[f];if(c)return Nt=c.nextPos,c.result;if(t=Nt,(r=gr())!==u){for(n=[],s=kr();s!==u;)n.push(s),s=kr();if(60===e.charCodeAt(Nt)?(s="<",Nt++):(s=u,0===Ft&&Bt(ot)),s!==u){for(o=[],a=kr();a!==u;)o.push(a),a=kr();if((a=xr())!==u){for(l=[],i=kr();i!==u;)l.push(i),i=kr();62===e.charCodeAt(Nt)?(i=">",Nt++):(i=u,0===Ft&&Bt(ut)),i!==u?(Dt=t,t=Sr("named",{name:r,inner:a})):(Nt=t,t=u)}else Nt=t,t=u}else Nt=t,t=u}else Nt=t,t=u;t===u&&(t=Nt,(r=gr())!==u&&(Dt=t,r=function(e){return Sr("named",{name:e,inner:null})}(r)),t=r);return Ut[f]={nextPos:Nt,result:t},t}()),Ut[r]={nextPos:Nt,result:t},t)}function gr(){var t,r,n,s,o=77*Nt+70,a=Ut[o];if(a)return Nt=a.nextPos,a.result;if(t=Nt,ee.test(e.charAt(Nt))?(r=e.charAt(Nt),Nt++):(r=u,0===Ft&&Bt(at)),r!==u){for(n=[],te.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(lt));s!==u;)n.push(s),te.test(e.charAt(Nt))?(s=e.charAt(Nt),Nt++):(s=u,0===Ft&&Bt(lt));Dt=t,t=vt()}else Nt=t,t=u;return Ut[o]={nextPos:Nt,result:t},t}function Ar(){var t,r,n,s,o,a=77*Nt+71,l=Ut[a];if(l)return Nt=l.nextPos,l.result;if(t=Nt,gr()!==u){for(r=[],n=Nt,58===e.charCodeAt(Nt)?(s=m,Nt++):(s=u,0===Ft&&Bt(ye)),s!==u&&(o=gr())!==u?n=s=[s,o]:(Nt=n,n=u);n!==u;)r.push(n),n=Nt,58===e.charCodeAt(Nt)?(s=m,Nt++):(s=u,0===Ft&&Bt(ye)),s!==u&&(o=gr())!==u?n=s=[s,o]:(Nt=n,n=u);Dt=t,t=vt()}else Nt=t,t=u;return Ut[a]={nextPos:Nt,result:t},t}function br(){var t,r,n,s,o,a=77*Nt+72,l=Ut[a];if(l)return Nt=l.nextPos,l.result;for(t=Nt,r=[],n=Cr();n!==u;)r.push(n),n=Cr();if(44===e.charCodeAt(Nt)?(n=w,Nt++):(n=u,0===Ft&&Bt(we)),n!==u){for(s=[],o=Cr();o!==u;)s.push(o),o=Cr();t=r=[r,n,s]}else Nt=t,t=u;if(t===u)if(t=[],(r=Cr())!==u)for(;r!==u;)t.push(r),r=Cr();else t=u;return Ut[a]={nextPos:Nt,result:t},t}function Pr(){var t,r=77*Nt+73,n=Ut[r];return n?(Nt=n.nextPos,n.result):("\r\n"===e.substr(Nt,2)?(t="\r\n",Nt+=2):(t=u,0===Ft&&Bt(it)),t===u&&(re.test(e.charAt(Nt))?(t=e.charAt(Nt),Nt++):(t=u,0===Ft&&Bt(ft))),Ut[r]={nextPos:Nt,result:t},t)}function wr(){var t,r,n=77*Nt+74,s=Ut[n];return s?(Nt=s.nextPos,s.result):(t=Nt,Ft++,e.length>Nt?(r=e.charAt(Nt),Nt++):(r=u,0===Ft&&Bt(oe)),Ft--,r===u?t=void 0:(Nt=t,t=u),t===u&&(t=Pr()),Ut[n]={nextPos:Nt,result:t},t)}function Cr(){var t,r=77*Nt+75,n=Ut[r];return n?(Nt=n.nextPos,n.result):(ne.test(e.charAt(Nt))?(t=e.charAt(Nt),Nt++):(t=u,0===Ft&&Bt(ct)),Ut[r]={nextPos:Nt,result:t},t)}function kr(){var t,r=77*Nt+76,n=Ut[r];return n?(Nt=n.nextPos,n.result):(se.test(e.charAt(Nt))?(t=e.charAt(Nt),Nt++):(t=u,0===Ft&&Bt(pt)),Ut[r]={nextPos:Nt,result:t},t)}function _r(e){let t=function(e,t){const r=[];for(let n=0;n<e.length;n++)0!=n&&t(e[n-1],e[n])?r[r.length-1].push(e[n]):r.push([e[n]]);return r}(e,((e,t)=>typeof t==typeof e));return t=t.map((e=>"string"==typeof e[0]?[e.join("")]:e)),function(e){return e.reduce(((e,t)=>e.concat(t)),[])}(t)}function Sr(e,t,r){const n={type:e};t.children=r;for(const o of Object.keys(t))void 0!==t[o]&&(n[o]=t[o]);const s=Zt(Dt,Nt);return n.loc={start:s.start.offset,end:s.end.offset-1},n}if((r=i())!==u&&Nt===e.length)return r;throw r!==u&&Nt<e.length&&Bt({type:"end"}),n=qt,s=It<e.length?e.charAt(It):null,o=It<e.length?Zt(It,It+1):Zt(It,It),new le(le.buildMessage(n,s),n,s,o)}ue([u],ae.prototype,"exec",1),ue([u],ae.prototype,"execFn",1),ue([u],ae.prototype,"log",1),ue([u],ae.prototype,"collectNs",1),ue([u],ae.prototype,"collectNsMember",1),ue([u],ae.prototype,"_fn",1),ue([u],ae.prototype,"_eval",1),ue([u],ae.prototype,"_run",1),ue([u],ae.prototype,"registerAbortHandler",1),ue([u],ae.prototype,"unregisterAbortHandler",1),ue([u],ae.prototype,"abort",1),ue([u],ae,"collectMetadata",1),function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(le,Error),le.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,o=this.location.source+":"+s.line+":"+s.column;if(n){var u=this.location.end,a=ie("",s.line.toString().length),l=n[s.line-1],i=s.line===u.line?u.column:l.length+1;t+="\n --\x3e "+o+"\n"+a+" |\n"+s.line+" | "+l+"\n"+a+" | "+ie("",s.column-1)+ie("",i-s.column,"^")}else t+="\n at "+o}return t},le.buildMessage=function(e,t){var r,n={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?u(e[0])+"-"+u(e[1]):u(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function s(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+s(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+s(e)}))}function u(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+s(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+s(e)}))}function a(e){return n[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(a);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+(((r=t)?'"'+o(r)+'"':"end of input")+" found.")};const ce=["null","true","false","each","for","loop","while","break","continue","match","if","elif","else","return"];function pe(e){var t;for(const r of e)switch(r.type){case"def":case"assign":case"ns":if(ce.includes(r.name))throw new ve(`Reserved word "${r.name}" cannot be used as variable name.`);break;case"fn":pe(r.children);break;case"block":pe(r.statements);break;case"if":"block"===r.then.type&&pe(r.then.statements);for(const e of r.elseif)"block"===e.then.type&&pe(e.then.statements);"block"===(null==(t=r.else)?void 0:t.type)&&pe(r.else.statements)}return e}class he extends Error{constructor(e){let t="Syntax error.";e&&(t+=` ${e}`),super(t)}}class ve extends Error{constructor(e){let t="Semantic error.";e&&(t+=` ${e}`),super(t)}}function de(e){return{type:"simple",name:e}}function ye(e){switch(e.type){case"named":if(e.inner){const t=ye(e.inner);return`${e.name}<${t}>`}return e.name;case"fn":return`(${e.args.map((e=>ye(e))).join(", ")}) -> ${ye(e.result)}`}}function me(e){if("named"===e.type){switch(e.name){case"null":case"bool":case"num":case"str":case"any":case"void":if(null==e.inner)return de(e.name);break;case"arr":case"obj":{let t;return t=null!=e.inner?me(e.inner):de("any"),{type:"generic",name:e.name,inners:[t]}}}throw new ve(`Unknown type: '${ye(e)}'`)}{const n=e.args.map((e=>me(e)));return t=n,r=me(e.result),{type:"fn",args:t,result:r}}var t,r}function xe(e){switch(e.type){case"def":null!=e.varType&&me(e.varType),xe(e.expr);break;case"fn":for(const t of e.args)null!=t.type&&me(t.type);null!=e.ret&&me(e.ret);for(const t of e.children)xe(t)}}function ge(e){for(const t of e)xe(t);return e}function Ae(e){const t=[],r=[];for(const n of e)if("attr"===n.type)r.push(n);else if("def"===n.type)n.attr.push(...r),r.splice(0,r.length),"fn"===n.expr.type&&(n.expr.children=Ae(n.expr.children)),t.push(n);else{if(r.length>0)throw new ve("invalid attribute.");switch(n.type){case"fn":n.children=Ae(n.children);break;case"block":n.statements=Ae(n.statements)}t.push(n)}if(r.length>0)throw new ve("invalid attribute.");return t}class be{constructor(){this.plugins=[pe,ge,Ae]}static parse(e){return null==be.instance&&(be.instance=new be),be.instance.parse(e)}addPlugin(e){this.plugins.push(e)}parse(e){let t;try{t=fe(e)}catch(r){if(r.location)throw r.expected?new he(`Line ${r.location.start.line}:${r.location.start.column}`):new he(`${r.message} Line ${r.location.start.line}:${r.location.start.column}`);throw r}for(const n of this.plugins)t=n(t);return t}}const Pe={def:0,assign:1,call:2,return:3,if:4,for:5,forOf:6,var:7,null:8,bool:9,num:10,str:11,arr:12,fn:13,obj:14,prop:15,propCall:16,index:17,block:18,tmpl:19,ns:20,match:21,meta:22,propAssign:23,indexAssign:24,inc:25,dec:26,attr:27,break:28,loop:29,continue:30,infix:31};function we(e){if(null==e)return null;switch(e.type){case"def":return[Pe[e.type],e.name,e.mut,we(e.expr),Ce(e.attr)];case"assign":return[Pe[e.type],e.name,we(e.expr)];case"call":return[Pe[e.type],e.name,Ce(e.args)];case"return":return[Pe[e.type],we(e.expr)];case"if":return[Pe[e.type],we(e.cond),we(e.then),e.elseif.map((e=>[we(e.cond),we(e.then)])),we(e.else)];case"for":return[Pe[e.type],e.var,we(e.from),we(e.to),we(e.times),we(e.for)];case"forOf":return[Pe[e.type],e.var,we(e.items),we(e.for)];case"var":return[Pe[e.type],e.name];case"null":return[Pe[e.type]];case"bool":case"num":case"str":return[Pe[e.type],e.value];case"arr":return[Pe[e.type],Ce(e.value)];case"fn":return[Pe[e.type],e.args.map((e=>[e.name])),Ce(e.children)];case"obj":return[Pe[e.type],Array.from(e.value.entries()).map((e=>[e[0],we(e[1])]))];case"prop":return[Pe[e.type],e.obj,e.path];case"propCall":return[Pe[e.type],e.obj,e.path,Ce(e.args)];case"index":return[Pe[e.type],e.arr,we(e.i)];case"block":return[Pe[e.type],Ce(e.statements)];case"tmpl":return[Pe[e.type],e.tmpl.map((e=>"string"==typeof e?e:we(e)))];case"ns":return[Pe[e.type],e.name,Ce(e.members)];case"match":return[Pe[e.type],we(e.about),e.qs.map((e=>[we(e.q),we(e.a)])),we(e.default)];case"meta":return[Pe[e.type],e.name,we(e.value)];case"propAssign":return[Pe[e.type],e.obj,e.path,we(e.expr)];case"indexAssign":return[Pe[e.type],e.arr,we(e.i),we(e.expr)];case"inc":case"dec":return[Pe[e.type],e.name,we(e.expr)];case"attr":return[Pe[e.type],e.name,we(e.value)];case"break":return[Pe[e.type],null];case"loop":return[Pe[e.type],Ce(e.statements)];case"continue":return[Pe[e.type],null];case"infix":return[Pe[e.type],Ce(e.operands),e.operators]}}function Ce(e){return e.map((e=>we(e)))}const ke={id:"root"},_e=m("h1",null,"AiScript (v0.11.1) Playground",-1),Se={id:"grid1"},je={id:"editor",class:"container"},Me=w("Input"),Oe={key:0,class:"syntaxError"},$e={id:"logs",class:"container"},Ee=m("header",null,"Output",-1),Ne={class:"type"},De={id:"grid2"},He={id:"ast",class:"container"},Ie=m("header",null,"AST",-1),qe={id:"bin",class:"container"},Fe=m("header",null,"Bytecode",-1),Ue=m("div",{id:"debugger",class:"container"},[m("header",null,"Debugger"),m("div")],-1);_({setup(e){const t=h(window.localStorage.getItem("script")||'<: "Hello, AiScript!"'),r=h(null),n=h(null),s=h([]),o=h(!1);v(t,(()=>{window.localStorage.setItem("script",t.value);try{r.value=be.parse(t.value),o.value=!1}catch(e){return o.value=!0,void console.error(e)}n.value=Ce(r.value)}),{immediate:!0});const u=()=>{t.value='for (#i, 100) {\n  <: if (i % 15 == 0) "FizzBuzz"\n    elif (i % 3 == 0) "Fizz"\n    elif (i % 5 == 0) "Buzz"\n    else i\n}'},a=async()=>{s.value=[];const e=new ae({},{in:e=>new Promise((t=>{t(window.prompt(e))})),out:e=>{s.value.push({id:Math.random(),type:e.type,text:"str"===e.type||"num"===e.type?e.value:G(e),print:!0})},log:(e,t)=>{switch(e){case"end":s.value.push({id:Math.random(),text:G(t.val,!0),print:!1})}}});try{await e.exec(r.value)}catch(t){console.error(t),window.alert("Error: "+t)}},l=e=>C.exports.highlight(e,C.exports.languages.js,"javascript");return(e,i)=>(d(),y("div",ke,[_e,m("div",Se,[m("div",je,[m("header",null,[Me,m("div",{class:"actions"},[m("button",{onClick:u},"FizzBuzz")])]),m("div",null,[m(x(k),{class:"code",modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=e=>t.value=e),highlight:l,"line-numbers":!1},null,8,["modelValue"])]),m("footer",null,[o.value?(d(),y("span",Oe,"Syntax Error!")):g("",!0),m("div",{class:"actions"},[m("button",{onClick:a},"RUN")])])]),m("div",$e,[Ee,m("div",null,[(d(!0),y(A,null,b(s.value,(e=>(d(),y("div",{class:["log",[{print:e.print},e.type]],key:e.id},[m("span",Ne,P(e.type),1),w(" "+P(e.text),1)],2)))),128))])])]),m("div",De,[m("div",He,[Ie,m("div",null,[m("pre",null,P(JSON.stringify(r.value,null,"\t")),1)])]),m("div",qe,[Fe,m("div",null,[m("code",null,P(JSON.stringify(n.value)),1)])]),Ue])]))}}).mount("#app");
